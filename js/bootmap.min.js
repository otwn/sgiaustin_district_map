var map,featureList,app={};var listSearch=[];app.author="Shin Kobara";app.copyright="SGI-USA Austin";app.title="SGI Austin TX District Map";app.html="http://sgiusaaustin.org";app.desc="District/Chapter boundary map";$("#nav-btn").click(function(){$(".navbar-collapse").collapse("toggle");return false});$("#sidebar-toggle-btn").click(function(){$("#sidebar").toggle();map.invalidateSize();return false});$("#sidebar-hide-btn").click(function(){$("#sidebar").hide();map.invalidateSize()});$("#panel-btn").click(function(){$("#sidebar").toggle();map.invalidateSize();return false});$("#about-btn").click(function(){$("#aboutModal").modal("show");$(".navbar-collapse.in").collapse("hide");return false});$(window).resize(function(){sizeLayerControl()});function sizeLayerControl(){$(".leaflet-control-layers").css("max-height",$("#map").height()-50)}function startLoading(){map.spin(true)}function finishedLoading(){setTimeout(function(){map.spin(false)},1000)}map=L.map("map",{zoomControl:false,scrollWheelZoom:true,zoom:10,center:[30.34761,-97.7147]});var osMap=L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://osm.org/copyright">OpenStreetMap</a> contributors'});var esriTopo=L.esri.tiledMapLayer({url:"https://services.arcgisonline.com/ArcGIS/rest/services/USA_Topo_Maps/MapServer",maxZoom:15});var esriImage=L.tileLayer("http://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}");var cartodb_light=L.tileLayer("http://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png",{attribution:'Map data &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, &copy; <a href="http://cartodb.com/attributions">CartoDB</a>',maxZoom:18});var cartodb_dark=L.tileLayer("http://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}.png",{attribution:'Map data &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, &copy; <a href="http://cartodb.com/attributions">CartoDB</a>',maxZoom:18});var mapboxtoken="pk.eyJ1Ijoic2dpdXNhYXVzdGluIiwiYSI6ImNpcXB1amViMjAyamRmbm5uejc1M2llYm0ifQ.LQQZ5t-oK4xMAqyjc3R-Mw";var mapbox=L.tileLayer("https://api.tiles.mapbox.com/v4/mapbox.streets/{z}/{x}/{y}@2x.png?access_token="+mapboxtoken,{attribution:'Map data &copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors. Tiles from <a href="https://www.mapbox.com">Mapbox</a>.'});var baseLayers={Light:cartodb_light,Dark:cartodb_dark,"Esri World Imagery":esriImage,Topography:esriTopo,"Open Street Map":osMap,"Mapbox Street":mapbox};map.addLayer(mapbox);var zoomControl=L.control.zoom({position:"bottomright"}).addTo(map);L.control.defaultExtent({position:"bottomright"}).addTo(map);var mousemove=document.getElementById("mousemove");map.on("mousemove",function(a){window[a.type].innerHTML=a.latlng.toString()+" Zoom:"+map.getZoom()});var locateControl=L.control.locate({position:"bottomright",markerStyle:{weight:1,opacity:0.8,fillOpacity:0.8},circleStyle:{weight:1,clickable:false},icon:"fa fa-map-marker",strings:{title:"My location",metersUnit:"meters",feetUnit:"feet",popup:"You are within {distance} {unit} from this point",outsideMapBoundsMsg:"You seem located outside the boundaries of the map"}}).addTo(map);var arcgisOnline=L.esri.Geocoding.arcgisOnlineProvider();var geosearchControl=L.esri.Geocoding.geosearch({providers:[arcgisOnline],position:"topleft"}).addTo(map);var results=L.layerGroup().addTo(map);geosearchControl.on("results",function(b){results.clearLayers();for(var a=b.results.length-1;a>=0;a--){results.addLayer(L.marker(b.results[a].latlng));weatherMarker.setLatLng(b.results[a].latlng);onDragEnd()}});var redMarker=L.ExtraMarkers.icon({icon:"fa-info-circle",prefix:"fa",shape:"circle",markerColor:"red",iconColor:"white"});var weatherMarker=L.marker([30.34761,-97.7147],{icon:redMarker,riseOnHover:true,zIndexOffset:2000,draggable:true}).addTo(map);weatherMarker.on({click:function(a){$("#weatherModal").modal("show")}});weatherMarker.on("dragend",onDragEnd);onDragEnd();function onDragEnd(){$("#latlng_div").html("");$("#weather_div").html("");var a=weatherMarker.getLatLng();var c;$.ajax({url:"https://api.forecast.io/forecast/97623ae781a11fd55f315cd4ffb61f96/"+a.lat+","+a.lng,dataType:"jsonp",success:function(d){L.esri.Geocoding.reverseGeocode().latlng([a.lat,a.lng]).run(function(f,e){if(e){c=e.address.Match_addr}else{c="Cannot find"}$("#reverseAddress").html(c)});$("#latlng_div").append("Latitude: <b>"+a.lat.toFixed(5)+"</b>&deg;<br />Longitude: <b>"+a.lng.toFixed(5)+"</b>&deg;<br /><br />Address: <div id='reverseAddress'></div>");$("#weather_div").append("<iframe id='forecast_embed' type='text/html' frameborder='0' height='245' width='100%'' src='http://forecast.io/embed/#lat="+a.lat+"&lon="+a.lng+"&name=Lat:"+a.lat.toFixed(2)+"&deg; Long:"+a.lng.toFixed(2)+"&deg;'> </iframe>")},error:function(d){console.warn(d)}});var b=new ZeroClipboard($(".clip_button"));b.on("ready",function(d){b.on("copy",function(f){var e=c;f.clipboardData.setData("text/plain",e)});b.on("aftercopy",function(e){alert("Copied text to clipboard: "+e.data["text/plain"])})});b.on("error",function(d){ZeroClipboard.destroy()})}var highlight=L.geoJson(null);var defaultStyle={color:"#2262CC",weight:3,opacity:0.9,fillOpacity:0.2,fillColor:"#2262CC"};var highlightStyle={color:"#2262CC",weight:5,opacity:0.6,fillOpacity:0.65,fillColor:"#2262CC"};var dataJSON=L.geoJson(null,{style:defaultStyle,onEachFeature:function(b,a){if(b.properties){a.bindPopup("District: <b>"+b.properties.District+"</b><br />Chapter: <b>"+b.properties.Chapter+"</b>");$("#feature-list tbody").append('<tr class="feature-row" id="'+L.stamp(a)+'"><td style="vertical-align: middle;"><img width="18" height="18" src="images/check_in.png"></td><td><span class="feature-name">'+a.feature.properties.District+'</span><br /><small><span class="feature-chapter">'+a.feature.properties.Chapter+'</span></small></td><td style="vertical-align: middle;"><i class="fa fa-chevron-right pull-right"></i></td></tr>');listSearch.push({oid:a.feature.properties.OBJECTID,name:a.feature.properties.District,chapter:a.feature.properties.Chapter,source:"dataJSON"})}a.on({mouseover:function(d){var c=d.target;c.setStyle(highlightStyle);if(!L.Browser.ie&&!L.Browser.opera){c.bringToFront()}},mouseout:function(c){dataJSON.resetStyle(c.target)}})}});queue().defer(d3.json,"data/shapefile/austindistricts.geojson").await(function(a,b){dataJSON.addData(b);map.addLayer(dataJSON);map.addLayer(highlight);syncSidebar();sizeLayerControl();finishedLoading()});var groupedOverlay={"Polygon of Interest":{District:dataJSON}};function syncSidebar(){$("#feature-list tbody").empty();dataJSON.eachLayer(function(a){if(map.getBounds().intersects(a.getLatLngs())){$("#feature-list tbody").append('<tr class="feature-row" id="'+L.stamp(a)+'"><td style="vertical-align: middle;"><img width="18" height="18" src="images/check_in.png"></td><td><span class="feature-name">'+a.feature.properties.District+'</span><br /><small><span class="feature-chapter">'+a.feature.properties.Chapter+'</span></small></td><td style="vertical-align: middle;"><i class="fa fa-chevron-right pull-right"></i></td></tr>')}});featureList=new List("features",{valueNames:["feature-name","feature-chapter"]});featureList.sort("feature-chapter",{order:"asc"})}function sidebarClick(b){var a=dataJSON.getLayer(b);map.fitBounds(a.getBounds());if(document.body.clientWidth<=767){$("#sidebar").hide();map.invalidateSize()}}$(document).on("click",".feature-row",function(a){sidebarClick(parseInt($(this).attr("id")))});$(document).on("mouseover",".feature-row",function(b){var a=dataJSON.getLayer($(this).attr("id"));highlight.clearLayers().addLayer(L.polygon(a.getLatLngs(),highlightStyle))});$(document).on("mouseout",".feature-row",function(a){highlight.clearLayers()});map.on("moveend",function(a){syncSidebar()});if(document.body.clientWidth<=767){var isCollapsed=true}else{var isCollapsed=false}var layerControl=L.control.groupedLayers(baseLayers,groupedOverlay,{}).addTo(map);var container=$(".leaflet-control-layers")[0];if(!L.Browser.touch){L.DomEvent.disableClickPropagation(container).disableScrollPropagation(container)}else{L.DomEvent.disableClickPropagation(container)};