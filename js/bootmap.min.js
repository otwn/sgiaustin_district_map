function sizeLayerControl(){$(".leaflet-control-layers").css("max-height",$("#map").height()-50)}function startLoading(){map.spin(!0)}function finishedLoading(){setTimeout(function(){map.spin(!1)},1e3)}function updateAttribution(e){$.each(map._layers,function(e,t){t.getAttribution&&$("#attribution").html(t.getAttribution())})}function onDragEnd(){$("#latlng_div").html(""),$("#weather_div").html("");var e,t=weatherMarker.getLatLng();$.ajax({url:"https://api.forecast.io/forecast/fce73211ba8678302a5ce7b9732703aa/"+t.lat+","+t.lng,dataType:"jsonp",success:function(a){L.esri.Geocoding.Tasks.reverseGeocode().latlng([t.lat,t.lng]).run(function(t,a){e=a?a.address.Match_addr:"Cannot find",$("#reverseAddress").html(e)}),$("#latlng_div").append("Latitude: <b>"+t.lat.toFixed(5)+"</b>&deg;<br />Longitude: <b>"+t.lng.toFixed(5)+"</b>&deg;<br /><br />Address: <div id='reverseAddress'></div>"),$("#weather_div").append("<iframe id='forecast_embed' type='text/html' frameborder='0' height='245' width='100%'' src='http://forecast.io/embed/#lat="+t.lat+"&lon="+t.lng+"&name=Lat:"+t.lat.toFixed(2)+"&deg; Long:"+t.lng.toFixed(2)+"&deg;'> </iframe>")},error:function(e){console.warn(e)}});var a=new ZeroClipboard($(".clip_button"));a.on("ready",function(t){a.on("copy",function(t){var a=e;t.clipboardData.setData("text/plain",a)}),a.on("aftercopy",function(e){alert("Copied text to clipboard: "+e.data["text/plain"])})}),a.on("error",function(e){ZeroClipboard.destroy()})}function syncSidebar(){$("#feature-list tbody").empty(),dataJSON.eachLayer(function(e){map.getBounds().intersects(e.getLatLngs())&&$("#feature-list tbody").append('<tr class="feature-row" id="'+L.stamp(e)+'"><td style="vertical-align: middle;"><img width="18" height="18" src="images/check_in.png"></td><td><span class="feature-name">'+e.feature.properties.District+'</span><br /><small><span class="feature-chapter">'+e.feature.properties.Chapter+'</span></small></td><td style="vertical-align: middle;"><i class="fa fa-chevron-right pull-right"></i></td></tr>')}),featureList=new List("features",{valueNames:["feature-name","feature-chapter"]}),featureList.sort("feature-chapter",{order:"asc"})}function sidebarClick(e){var t=dataJSON.getLayer(e);map.fitBounds(t.getBounds()),document.body.clientWidth<=767&&($("#sidebar").hide(),map.invalidateSize())}var map,featureList,app={},listSearch=[];app.author="Shin Kobara",app.copyright="SGI-USA Austin",app.title="SGI Austin TX District Map",app.html="http://sgiusaaustin.org",app.desc="District/Chapter boundary map",$(window).resize(function(){sizeLayerControl()}),map=L.map("map",{zoomControl:!1,scrollWheelZoom:!0,zoom:10,center:[30.34761,-97.7147],attributionControl:!1}),startLoading();var mapquestOSM=L.tileLayer("http://{s}.mqcdn.com/tiles/1.0.0/osm/{z}/{x}/{y}.png",{maxZoom:20,subdomains:["otile1","otile2","otile3","otile4"],attribution:'Tiles courtesy of <a href="http://www.mapquest.com/" target="_blank">MapQuest</a> <img src="http://developer.mapquest.com/content/osm/mq_logo.png">. Map data (c) <a href="http://www.openstreetmap.org/" target="_blank">OpenStreetMap</a> contributors, CC-BY-SA.'}),mapquestHYB=L.layerGroup([L.tileLayer("http://{s}.mqcdn.com/tiles/1.0.0/sat/{z}/{x}/{y}.jpg",{maxZoom:20,subdomains:["oatile1","oatile2","oatile3","oatile4"]}),L.tileLayer("http://{s}.mqcdn.com/tiles/1.0.0/hyb/{z}/{x}/{y}.png",{maxZoom:20,subdomains:["oatile1","oatile2","oatile3","oatile4"],attribution:'Labels courtesy of <a href="http://www.mapquest.com/" target="_blank">MapQuest</a> <img src="http://developer.mapquest.com/content/osm/mq_logo.png">. Map data (c) <a href="http://www.openstreetmap.org/" target="_blank">OpenStreetMap</a> contributors, CC-BY-SA. Portions Courtesy NASA/JPL-Caltech and U.S. Depart. of Agriculture, Farm Service Agency | Points data from <a href="http://galvbay.org">galvbay.org</a>'})]),esriOcean=L.layerGroup([L.esri.tiledMapLayer("http://services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer",{attribution:'&copy; <a href="http://www.esri.com/">Esri</a>, GEBCO, NOAA, National Geographic, DeLorme, HERE, Geonames.org, and other contributors| Points data from <a href="http://galvbay.org">galvbay.org</a>'}),L.esri.tiledMapLayer("http://server.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer",{attribution:'&copy; <a href="http://www.esri.com/">Esri</a>, GEBCO, NOAA, National Geographic, DeLorme, HERE, Geonames.org, and other contributors| Points data from <a href="http://galvbay.org">galvbay.org</a>'})]),esriTopo=L.esri.tiledMapLayer("http://services.arcgisonline.com/arcgis/rest/services/World_Topo_Map/MapServer",{attribution:'&copy; <a href="http://www.esri.com/">Esri</a>, HERE, DeLorme, TomTom, Intermap, increment P Corp., GEBCO, USGS, FAO, NPS, NRCAN, GeoBase, IGN, Kadaster NL, Ordnance Survey, Esri Japan, METI, Esri China (Hong Kong), swisstopo, MapmyIndia, Â© OpenStreetMap contributors, GIS User Comm. | Points data from <a href="http://galvbay.org">galvbay.org</a>'}),esriImage=L.tileLayer("http://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{attribution:'&copy; <a href="http://www.esri.com/">Esri</a>, DigitalGlobe, Earthstar Geographics, CNES/Airbus DS, GeoEye, USDA FSA, USGS, Getmapping, Aerogrid, IGN, IGP, swisstopo, and the GIS User Community | Points data from <a href="http://galvbay.org">galvbay.org</a>',maxZoom:18}),cartodb_light=L.tileLayer("http://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png",{attribution:'Map data &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, &copy; <a href="http://cartodb.com/attributions">CartoDB</a> | Points data from <a href="http://galvbay.org">galvbay.org</a>',maxZoom:18}),cartodb_dark=L.tileLayer("http://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}.png",{attribution:'Map data &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, &copy; <a href="http://cartodb.com/attributions">CartoDB</a> | Points data from <a href="http://galvbay.org">galvbay.org</a>',maxZoom:18}),ggl=new L.Google,ggl2=new L.Google("TERRAIN"),baseLayers={"Street Map":mapquestOSM,Light:cartodb_light,Dark:cartodb_dark,"Imagery with Streets":mapquestHYB,"Esri World Imagery":esriImage,Topography:esriTopo,Google:ggl,"Google Terrain":ggl2};map.addLayer(mapquestOSM);var zoomControl=L.control.zoom({position:"bottomright"}).addTo(map);L.control.defaultExtent({position:"bottomright"}).addTo(map);var locateControl=L.control.locate({position:"bottomright",drawCircle:!0,follow:!0,setView:!0,keepCurrentZoomLevel:!0,markerStyle:{weight:1,opacity:.8,fillOpacity:.8},circleStyle:{weight:1,clickable:!1},icon:"fa fa-map-marker",metric:!1,strings:{title:"My location",metersUnit:"meters",feetUnit:"feet",popup:"You are within {distance} {unit} from this point",outsideMapBoundsMsg:"You seem located outside the boundaries of the map"},locateOptions:{maxZoom:17,watch:!0,enableHighAccuracy:!0,maximumAge:1e4,timeout:1e4}}).addTo(map);map.on("dragstart",locateControl._stopFollowing,locateControl);var drawnItems=L.featureGroup().addTo(map);map.addControl(new L.Control.Draw({edit:{featureGroup:drawnItems}})),map.on("draw:created",function(e){var t=e.layer;drawnItems.addLayer(t)}),L.Control.measureControl().addTo(map),L.Control.FileLayerLoad.LABEL='<i class="fa fa-folder-open"></i>',L.Control.fileLayerLoad({fitBounds:!0,layerOptions:{style:{color:"red",opacity:1,fillOpacity:1,weight:2,clickable:!1}},fileSizeLimit:1024,formats:[".geojson",".kml"]}).addTo(map),$(".leaflet-top.leaflet-left").hide();var geoSearchControl=new L.esri.Geocoding.Controls.Geosearch({position:"bottomright",providers:[new L.esri.Geocoding.Controls.Geosearch.Providers.FeatureLayer({url:"//services.arcgis.com/uCXeTVveQzP4IIcx/arcgis/rest/services/gisday/FeatureServer/0/",searchFields:["Name","Organization"],label:"GIS Day Events",bufferRadius:5e3,formatSuggestion:function(e){return e.properties.Name+" - "+e.properties.Organization}})]}).addTo(map),results=(new L.LayerGroup).addTo(map);geoSearchControl.on("results",function(e){results.clearLayers();for(var t=e.results.length-1;t>=0;t--)results.addLayer(L.marker(e.results[t].latlng)),weatherMarker.setLatLng(e.results[t].latlng),onDragEnd();console.log("geocoding!")}),map.on("layeradd",updateAttribution),map.on("layerremove",updateAttribution);var attributionControl=L.control({position:"bottomleft"});attributionControl.onAdd=function(e){var t=L.DomUtil.create("div","leaflet-control-attribution");return t.innerHTML="<span class='hidden-xs'><a href='http://products.gcoos.org' target='_blank'>GCOOS</a> | </span><a href='#' onclick='$(\"#attributionModal\").modal(\"show\"); return false;'>Attribution</a>",t},map.addControl(attributionControl);var redMarker=L.ExtraMarkers.icon({icon:"fa-info-circle",prefix:"fa",shape:"circle",markerColor:"red",iconColor:"white"}),weatherMarker=L.marker([30.34761,-97.7147],{icon:redMarker,riseOnHover:!0,zIndexOffset:2e3,draggable:!0}).addTo(map);weatherMarker.on({click:function(e){$("#weatherModal").modal("show")}}),weatherMarker.on("dragend",onDragEnd),onDragEnd();var highlight=L.geoJson(null),defaultStyle={color:"#2262CC",weight:3,opacity:.9,fillOpacity:.2,fillColor:"#2262CC"},highlightStyle={color:"#2262CC",weight:5,opacity:.6,fillOpacity:.65,fillColor:"#2262CC"},dataJSON=L.geoJson(null,{style:defaultStyle,onEachFeature:function(e,t){e.properties&&(t.bindPopup("District: <b>"+e.properties.District+"</b><br />Chapter: <b>"+e.properties.Chapter+"</b>"),$("#feature-list tbody").append('<tr class="feature-row" id="'+L.stamp(t)+'"><td style="vertical-align: middle;"><img width="18" height="18" src="images/check_in.png"></td><td><span class="feature-name">'+t.feature.properties.District+'</span><br /><small><span class="feature-chapter">'+t.feature.properties.Chapter+'</span></small></td><td style="vertical-align: middle;"><i class="fa fa-chevron-right pull-right"></i></td></tr>'),listSearch.push({oid:t.feature.properties.OBJECTID,name:t.feature.properties.District,chapter:t.feature.properties.Chapter,source:"dataJSON"})),t.on({mouseover:function(e){var t=e.target;t.setStyle(highlightStyle),L.Browser.ie||L.Browser.opera||t.bringToFront()},mouseout:function(e){dataJSON.resetStyle(e.target)}})}});queue().defer(d3.json,"data/shapefile/austindistricts.geojson").await(function(e,t){dataJSON.addData(t),map.addLayer(dataJSON),map.addLayer(highlight),syncSidebar(),sizeLayerControl(),finishedLoading()});var groupedOverlay={"Polygon of Interest":{District:dataJSON}};if($(document).on("click",".feature-row",function(e){sidebarClick(parseInt($(this).attr("id")))}),$(document).on("mouseover",".feature-row",function(e){var t=dataJSON.getLayer($(this).attr("id"));highlight.clearLayers().addLayer(L.polygon(t.getLatLngs(),highlightStyle))}),$(document).on("mouseout",".feature-row",function(e){highlight.clearLayers()}),map.on("moveend",function(e){syncSidebar(),console.log("sync side bar.")}),document.body.clientWidth<=767)var isCollapsed=!0;else var isCollapsed=!1;var layerControl=L.control.groupedLayers(baseLayers,groupedOverlay,{}).addTo(map),container=$(".leaflet-control-layers")[0];L.Browser.touch?L.DomEvent.disableClickPropagation(container):L.DomEvent.disableClickPropagation(container).disableScrollPropagation(container),$("#nav-btn").click(function(){return $(".navbar-collapse").collapse("toggle"),!1}),$("#sidebar-toggle-btn").click(function(){return $("#sidebar").toggle(),map.invalidateSize(),!1}),$("#sidebar-hide-btn").click(function(){$("#sidebar").hide(),map.invalidateSize()}),$("#panel-btn").click(function(){return $("#sidebar").toggle(),map.invalidateSize(),!1}),$("#print-btn").click(function(){return $("#map").print({stylesheet:"../css/bootmap.css"}),$(".navbar-collapse.in").collapse("hide"),!1}),$("#tools-btn").click(function(){return $(".leaflet-top.leaflet-left").toggle(),!1}),$("#draw-btn").click(function(){return $(".leaflet-draw").toggle(),!1}),$("#distance-btn").click(function(){return $(".leaflet-control-draw-measure").toggle(),!1}),$("#upload-btn").click(function(){return $(".leaflet-control-filelayer").toggle(),!1});var mousemove=document.getElementById("mousemove");map.on("mousemove",function(e){window[e.type].innerHTML=e.latlng.toString()+" Zoom:"+map.getZoom()}),$("#about-btn").click(function(){return $("#aboutModal").modal("show"),$(".navbar-collapse.in").collapse("hide"),!1});