L.Control.GroupedLayers=L.Control.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,exclusiveGroups:[]},initialize:function(t,e,i){var o,s;L.Util.setOptions(this,i),this._layers={},this._lastZIndex=0,this._handlingClick=!1,this._groupList=[],this._domGroups=[];for(o in t)this._addLayer(t[o],o);for(o in e)for(var s in e[o])this._addLayer(e[o][s],s,o,!0)},onAdd:function(t){return this._initLayout(),this._update(),t.on("layeradd",this._onLayerChange,this).on("layerremove",this._onLayerChange,this),this._container},onRemove:function(t){t.off("layeradd",this._onLayerChange).off("layerremove",this._onLayerChange)},addBaseLayer:function(t,e){return this._addLayer(t,e),this._update(),this},addOverlay:function(t,e,i){return this._addLayer(t,e,i,!0),this._update(),this},removeLayer:function(t){var e=L.Util.stamp(t);return delete this._layers[e],this._update(),this},_initLayout:function(){var t="leaflet-control-layers",e=this._container=L.DomUtil.create("div",t);e.setAttribute("aria-haspopup",!0),L.Browser.touch?L.DomEvent.on(e,"click",L.DomEvent.stopPropagation):(L.DomEvent.disableClickPropagation(e),L.DomEvent.on(e,"wheel",L.DomEvent.stopPropagation));var i=this._form=L.DomUtil.create("form",t+"-list");if(this.options.collapsed){L.Browser.android||L.DomEvent.on(e,"mouseover",this._expand,this).on(e,"mouseout",this._collapse,this);var o=this._layersLink=L.DomUtil.create("a",t+"-toggle",e);o.href="#",o.title="Layers",L.Browser.touch?L.DomEvent.on(o,"click",L.DomEvent.stop).on(o,"click",this._expand,this):L.DomEvent.on(o,"focus",this._expand,this),this._map.on("click",this._collapse,this)}else this._expand();this._baseLayersList=L.DomUtil.create("div",t+"-base",i),this._separator=L.DomUtil.create("div",t+"-separator",i),this._overlaysList=L.DomUtil.create("div",t+"-overlays",i),e.appendChild(i)},_addLayer:function(t,e,i,o){var s=L.Util.stamp(t);this._layers[s]={layer:t,name:e,overlay:o},i=i||"";var n=this._groupList.indexOf(i);-1===n&&(n=this._groupList.push(i)-1);var r=-1!=this.options.exclusiveGroups.indexOf(i);this._layers[s].group={name:i,id:n,exclusive:r},this.options.autoZIndex&&t.setZIndex&&(this._lastZIndex++,t.setZIndex(this._lastZIndex))},_update:function(){if(this._container){this._baseLayersList.innerHTML="",this._overlaysList.innerHTML="",this._domGroups.length=0;var t,e,i=!1,o=!1;for(t in this._layers)e=this._layers[t],this._addItem(e),o=o||e.overlay,i=i||!e.overlay;this._separator.style.display=o&&i?"":"none"}},_onLayerChange:function(t){var e=this._layers[L.Util.stamp(t.layer)];if(e){this._handlingClick||this._update();var i=e.overlay?"layeradd"===t.type?"overlayadd":"overlayremove":"layeradd"===t.type?"baselayerchange":null;i&&this._map.fire(i,e)}},_createRadioElement:function(t,e){var i='<input type="radio" class="leaflet-control-layers-selector" name="'+t+'"';e&&(i+=' checked="checked"'),i+="/>";var o=document.createElement("div");return o.innerHTML=i,o.firstChild},_addItem:function(t){var e,i,o=document.createElement("label"),s=this._map.hasLayer(t.layer);t.overlay?t.group.exclusive?(groupRadioName="leaflet-exclusive-group-layer-"+t.group.id,e=this._createRadioElement(groupRadioName,s)):(e=document.createElement("input"),e.type="checkbox",e.className="leaflet-control-layers-selector",e.defaultChecked=s):e=this._createRadioElement("leaflet-base-layers",s),e.layerId=L.Util.stamp(t.layer),L.DomEvent.on(e,"click",this._onInputClick,this);var n=document.createElement("span");if(n.innerHTML=" "+t.name,o.appendChild(e),o.appendChild(n),t.overlay){i=this._overlaysList;var r=this._domGroups[t.group.id];if(!r){r=document.createElement("div"),r.className="leaflet-control-layers-group",r.id="leaflet-control-layers-group-"+t.group.id;var a=document.createElement("span");a.className="leaflet-control-layers-group-name",a.innerHTML=t.group.name,r.appendChild(a),i.appendChild(r),this._domGroups[t.group.id]=r}i=r}else i=this._baseLayersList;return i.appendChild(o),o},_onInputClick:function(){var t,e,i,o=this._form.getElementsByTagName("input"),s=o.length;for(this._handlingClick=!0,t=0;s>t;t++)e=o[t],i=this._layers[e.layerId],e.checked&&!this._map.hasLayer(i.layer)?this._map.addLayer(i.layer):!e.checked&&this._map.hasLayer(i.layer)&&this._map.removeLayer(i.layer);this._handlingClick=!1},_expand:function(){L.DomUtil.addClass(this._container,"leaflet-control-layers-expanded")},_collapse:function(){this._container.className=this._container.className.replace(" leaflet-control-layers-expanded","")}}),L.control.groupedLayers=function(t,e,i){return new L.Control.GroupedLayers(t,e,i)},function(t,e){"function"==typeof define&&define.amd?define(["leaflet"],e):"object"==typeof exports?module.exports=e(require("leaflet")):t.L.Control.DefaultExtent=e(t.L)}(this,function(t){return function(){"use strict";return t.Control.DefaultExtent=t.Control.extend({options:{position:"topleft",text:"Default Extent",title:"Zoom to default extent",className:"leaflet-control-defaultextent"},onAdd:function(t){return this._map=t,this._initLayout()},setCenter:function(t){return this._center=t,this},setZoom:function(t){return this._zoom=t,this},_initLayout:function(){var e=t.DomUtil.create("div","leaflet-bar "+this.options.className);return this._container=e,this._fullExtentButton=this._createExtentButton(e),t.DomEvent.disableClickPropagation(e),this._map.whenReady(this._whenReady,this),this._container},_createExtentButton:function(){var e=t.DomUtil.create("a",this.options.className+"-toggle",this._container);return e.href="#",e.innerHTML=this.options.text,e.title=this.options.title,t.DomEvent.on(e,"mousedown dblclick",t.DomEvent.stopPropagation).on(e,"click",t.DomEvent.stop).on(e,"click",this._zoomToDefault,this),e},_whenReady:function(){return this._center||(this._center=this._map.getCenter()),this._zoom||(this._zoom=this._map.getZoom()),this},_zoomToDefault:function(){this._map.setView(this._center,this._zoom)}}),t.Map.addInitHook(function(){this.options.defaultExtentControl&&this.addControl(new t.Control.DefaultExtent)}),t.control.defaultExtent=function(e){return new t.Control.DefaultExtent(e)},t.Control.DefaultExtent}()}),!function(t,e){L.MarkerClusterGroup=L.FeatureGroup.extend({options:{maxClusterRadius:80,iconCreateFunction:null,spiderfyOnMaxZoom:!0,showCoverageOnHover:!0,zoomToBoundsOnClick:!0,singleMarkerMode:!1,disableClusteringAtZoom:null,removeOutsideVisibleBounds:!0,animateAddingMarkers:!1,spiderfyDistanceMultiplier:1,polygonOptions:{}},initialize:function(t){L.Util.setOptions(this,t),this.options.iconCreateFunction||(this.options.iconCreateFunction=this._defaultIconCreateFunction),this._featureGroup=L.featureGroup(),this._featureGroup.on(L.FeatureGroup.EVENTS,this._propagateEvent,this),this._nonPointGroup=L.featureGroup(),this._nonPointGroup.on(L.FeatureGroup.EVENTS,this._propagateEvent,this),this._inZoomAnimation=0,this._needsClustering=[],this._needsRemoving=[],this._currentShownBounds=null,this._queue=[]},addLayer:function(t){if(t instanceof L.LayerGroup){var e=[];for(var i in t._layers)e.push(t._layers[i]);return this.addLayers(e)}if(!t.getLatLng)return this._nonPointGroup.addLayer(t),this;if(!this._map)return this._needsClustering.push(t),this;if(this.hasLayer(t))return this;this._unspiderfy&&this._unspiderfy(),this._addLayer(t,this._maxZoom);var o=t,s=this._map.getZoom();if(t.__parent)for(;o.__parent._zoom>=s;)o=o.__parent;return this._currentShownBounds.contains(o.getLatLng())&&(this.options.animateAddingMarkers?this._animationAddLayer(t,o):this._animationAddLayerNonAnimated(t,o)),this},removeLayer:function(t){if(t instanceof L.LayerGroup){var e=[];for(var i in t._layers)e.push(t._layers[i]);return this.removeLayers(e)}return t.getLatLng?this._map?t.__parent?(this._unspiderfy&&(this._unspiderfy(),this._unspiderfyLayer(t)),this._removeLayer(t,!0),this._featureGroup.hasLayer(t)&&(this._featureGroup.removeLayer(t),t.setOpacity&&t.setOpacity(1)),this):this:(!this._arraySplice(this._needsClustering,t)&&this.hasLayer(t)&&this._needsRemoving.push(t),this):(this._nonPointGroup.removeLayer(t),this)},addLayers:function(t){var e,i,o,s=this._map,n=this._featureGroup,r=this._nonPointGroup;for(e=0,i=t.length;i>e;e++)if(o=t[e],o.getLatLng){if(!this.hasLayer(o))if(s){if(this._addLayer(o,this._maxZoom),o.__parent&&2===o.__parent.getChildCount()){var a=o.__parent.getAllChildMarkers(),l=a[0]===o?a[1]:a[0];n.removeLayer(l)}}else this._needsClustering.push(o)}else r.addLayer(o);return s&&(n.eachLayer(function(t){t instanceof L.MarkerCluster&&t._iconNeedsUpdate&&t._updateIcon()}),this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds)),this},removeLayers:function(t){var e,i,o,s=this._featureGroup,n=this._nonPointGroup;if(!this._map){for(e=0,i=t.length;i>e;e++)o=t[e],this._arraySplice(this._needsClustering,o),n.removeLayer(o);return this}for(e=0,i=t.length;i>e;e++)o=t[e],o.__parent?(this._removeLayer(o,!0,!0),s.hasLayer(o)&&(s.removeLayer(o),o.setOpacity&&o.setOpacity(1))):n.removeLayer(o);return this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds),s.eachLayer(function(t){t instanceof L.MarkerCluster&&t._updateIcon()}),this},clearLayers:function(){return this._map||(this._needsClustering=[],delete this._gridClusters,delete this._gridUnclustered),this._noanimationUnspiderfy&&this._noanimationUnspiderfy(),this._featureGroup.clearLayers(),this._nonPointGroup.clearLayers(),this.eachLayer(function(t){delete t.__parent}),this._map&&this._generateInitialClusters(),this},getBounds:function(){var t=new L.LatLngBounds;if(this._topClusterLevel)t.extend(this._topClusterLevel._bounds);else for(var e=this._needsClustering.length-1;e>=0;e--)t.extend(this._needsClustering[e].getLatLng());return t.extend(this._nonPointGroup.getBounds()),t},eachLayer:function(t,e){var i,o=this._needsClustering.slice();for(this._topClusterLevel&&this._topClusterLevel.getAllChildMarkers(o),i=o.length-1;i>=0;i--)t.call(e,o[i]);this._nonPointGroup.eachLayer(t,e)},getLayers:function(){var t=[];return this.eachLayer(function(e){t.push(e)}),t},getLayer:function(t){var e=null;return this.eachLayer(function(i){L.stamp(i)===t&&(e=i)}),e},hasLayer:function(t){if(!t)return!1;var e,i=this._needsClustering;for(e=i.length-1;e>=0;e--)if(i[e]===t)return!0;for(i=this._needsRemoving,e=i.length-1;e>=0;e--)if(i[e]===t)return!1;return!(!t.__parent||t.__parent._group!==this)||this._nonPointGroup.hasLayer(t)},zoomToShowLayer:function(t,e){var i=function(){if((t._icon||t.__parent._icon)&&!this._inZoomAnimation)if(this._map.off("moveend",i,this),this.off("animationend",i,this),t._icon)e();else if(t.__parent._icon){var o=function(){this.off("spiderfied",o,this),e()};this.on("spiderfied",o,this),t.__parent.spiderfy()}};t._icon&&this._map.getBounds().contains(t.getLatLng())?e():t.__parent._zoom<this._map.getZoom()?(this._map.on("moveend",i,this),this._map.panTo(t.getLatLng())):(this._map.on("moveend",i,this),this.on("animationend",i,this),this._map.setView(t.getLatLng(),t.__parent._zoom+1),t.__parent.zoomToBounds())},onAdd:function(t){this._map=t;var e,i,o;if(!isFinite(this._map.getMaxZoom()))throw"Map has no maxZoom specified";for(this._featureGroup.onAdd(t),this._nonPointGroup.onAdd(t),this._gridClusters||this._generateInitialClusters(),e=0,i=this._needsRemoving.length;i>e;e++)o=this._needsRemoving[e],this._removeLayer(o,!0);for(this._needsRemoving=[],e=0,i=this._needsClustering.length;i>e;e++)o=this._needsClustering[e],o.getLatLng?o.__parent||this._addLayer(o,this._maxZoom):this._featureGroup.addLayer(o);this._needsClustering=[],this._map.on("zoomend",this._zoomEnd,this),this._map.on("moveend",this._moveEnd,this),this._spiderfierOnAdd&&this._spiderfierOnAdd(),this._bindEvents(),this._zoom=this._map.getZoom(),this._currentShownBounds=this._getExpandedVisibleBounds(),this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds)},onRemove:function(t){t.off("zoomend",this._zoomEnd,this),t.off("moveend",this._moveEnd,this),this._unbindEvents(),this._map._mapPane.className=this._map._mapPane.className.replace(" leaflet-cluster-anim",""),this._spiderfierOnRemove&&this._spiderfierOnRemove(),this._hideCoverage(),this._featureGroup.onRemove(t),this._nonPointGroup.onRemove(t),this._featureGroup.clearLayers(),this._map=null},getVisibleParent:function(t){for(var e=t;e&&!e._icon;)e=e.__parent;return e||null},_arraySplice:function(t,e){for(var i=t.length-1;i>=0;i--)if(t[i]===e)return t.splice(i,1),!0},_removeLayer:function(t,e,i){var o=this._gridClusters,s=this._gridUnclustered,n=this._featureGroup,r=this._map;if(e)for(var a=this._maxZoom;a>=0&&s[a].removeObject(t,r.project(t.getLatLng(),a));a--);var l,h=t.__parent,p=h._markers;for(this._arraySplice(p,t);h&&(h._childCount--,!(h._zoom<0));)e&&h._childCount<=1?(l=h._markers[0]===t?h._markers[1]:h._markers[0],o[h._zoom].removeObject(h,r.project(h._cLatLng,h._zoom)),s[h._zoom].addObject(l,r.project(l.getLatLng(),h._zoom)),this._arraySplice(h.__parent._childClusters,h),h.__parent._markers.push(l),l.__parent=h.__parent,h._icon&&(n.removeLayer(h),i||n.addLayer(l))):(h._recalculateBounds(),i&&h._icon||h._updateIcon()),h=h.__parent;delete t.__parent},_isOrIsParent:function(t,e){for(;e;){if(t===e)return!0;e=e.parentNode}return!1},_propagateEvent:function(t){if(t.layer instanceof L.MarkerCluster){if(t.originalEvent&&this._isOrIsParent(t.layer._icon,t.originalEvent.relatedTarget))return;t.type="cluster"+t.type}this.fire(t.type,t)},_defaultIconCreateFunction:function(t){var e=t.getChildCount(),i=" marker-cluster-";return i+=10>e?"small":100>e?"medium":"large",new L.DivIcon({html:"<div><span>"+e+"</span></div>",className:"marker-cluster"+i,iconSize:new L.Point(40,40)})},_bindEvents:function(){var t=this._map,e=this.options.spiderfyOnMaxZoom,i=this.options.showCoverageOnHover,o=this.options.zoomToBoundsOnClick;(e||o)&&this.on("clusterclick",this._zoomOrSpiderfy,this),i&&(this.on("clustermouseover",this._showCoverage,this),this.on("clustermouseout",this._hideCoverage,this),t.on("zoomend",this._hideCoverage,this))},_zoomOrSpiderfy:function(t){var e=this._map;e.getMaxZoom()===e.getZoom()?this.options.spiderfyOnMaxZoom&&t.layer.spiderfy():this.options.zoomToBoundsOnClick&&t.layer.zoomToBounds(),t.originalEvent&&13===t.originalEvent.keyCode&&e._container.focus()},_showCoverage:function(t){var e=this._map;this._inZoomAnimation||(this._shownPolygon&&e.removeLayer(this._shownPolygon),t.layer.getChildCount()>2&&t.layer!==this._spiderfied&&(this._shownPolygon=new L.Polygon(t.layer.getConvexHull(),this.options.polygonOptions),e.addLayer(this._shownPolygon)))},_hideCoverage:function(){this._shownPolygon&&(this._map.removeLayer(this._shownPolygon),this._shownPolygon=null)},_unbindEvents:function(){var t=this.options.spiderfyOnMaxZoom,e=this.options.showCoverageOnHover,i=this.options.zoomToBoundsOnClick,o=this._map;(t||i)&&this.off("clusterclick",this._zoomOrSpiderfy,this),e&&(this.off("clustermouseover",this._showCoverage,this),this.off("clustermouseout",this._hideCoverage,this),o.off("zoomend",this._hideCoverage,this))},_zoomEnd:function(){this._map&&(this._mergeSplitClusters(),this._zoom=this._map._zoom,this._currentShownBounds=this._getExpandedVisibleBounds())},_moveEnd:function(){if(!this._inZoomAnimation){var t=this._getExpandedVisibleBounds();this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,this._zoom,t),this._topClusterLevel._recursivelyAddChildrenToMap(null,this._map._zoom,t),this._currentShownBounds=t}},_generateInitialClusters:function(){var t=this._map.getMaxZoom(),e=this.options.maxClusterRadius;this.options.disableClusteringAtZoom&&(t=this.options.disableClusteringAtZoom-1),this._maxZoom=t,this._gridClusters={},this._gridUnclustered={};for(var i=t;i>=0;i--)this._gridClusters[i]=new L.DistanceGrid(e),this._gridUnclustered[i]=new L.DistanceGrid(e);this._topClusterLevel=new L.MarkerCluster(this,-1)},_addLayer:function(t,e){var i,o,s=this._gridClusters,n=this._gridUnclustered;for(this.options.singleMarkerMode&&(t.options.icon=this.options.iconCreateFunction({getChildCount:function(){return 1},getAllChildMarkers:function(){return[t]}}));e>=0;e--){i=this._map.project(t.getLatLng(),e);var r=s[e].getNearObject(i);if(r)return r._addChild(t),void(t.__parent=r);if(r=n[e].getNearObject(i)){var a=r.__parent;a&&this._removeLayer(r,!1);var l=new L.MarkerCluster(this,e,r,t);s[e].addObject(l,this._map.project(l._cLatLng,e)),r.__parent=l,t.__parent=l;var h=l;for(o=e-1;o>a._zoom;o--)h=new L.MarkerCluster(this,o,h),s[o].addObject(h,this._map.project(r.getLatLng(),o));for(a._addChild(h),o=e;o>=0&&n[o].removeObject(r,this._map.project(r.getLatLng(),o));o--);return}n[e].addObject(t,i)}this._topClusterLevel._addChild(t),t.__parent=this._topClusterLevel},_enqueue:function(t){this._queue.push(t),this._queueTimeout||(this._queueTimeout=setTimeout(L.bind(this._processQueue,this),300))},_processQueue:function(){for(var t=0;t<this._queue.length;t++)this._queue[t].call(this);this._queue.length=0,clearTimeout(this._queueTimeout),this._queueTimeout=null},_mergeSplitClusters:function(){this._processQueue(),this._zoom<this._map._zoom&&this._currentShownBounds.contains(this._getExpandedVisibleBounds())?(this._animationStart(),this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,this._zoom,this._getExpandedVisibleBounds()),this._animationZoomIn(this._zoom,this._map._zoom)):this._zoom>this._map._zoom?(this._animationStart(),this._animationZoomOut(this._zoom,this._map._zoom)):this._moveEnd()},_getExpandedVisibleBounds:function(){if(!this.options.removeOutsideVisibleBounds)return this.getBounds();var t=this._map,e=t.getBounds(),i=e._southWest,o=e._northEast,s=L.Browser.mobile?0:Math.abs(i.lat-o.lat),n=L.Browser.mobile?0:Math.abs(i.lng-o.lng);return new L.LatLngBounds(new L.LatLng(i.lat-s,i.lng-n,!0),new L.LatLng(o.lat+s,o.lng+n,!0))},_animationAddLayerNonAnimated:function(t,e){if(e===t)this._featureGroup.addLayer(t);else if(2===e._childCount){e._addToMap();var i=e.getAllChildMarkers();this._featureGroup.removeLayer(i[0]),this._featureGroup.removeLayer(i[1])}else e._updateIcon()}}),L.MarkerClusterGroup.include(L.DomUtil.TRANSITION?{_animationStart:function(){this._map._mapPane.className+=" leaflet-cluster-anim",this._inZoomAnimation++},_animationEnd:function(){this._map&&(this._map._mapPane.className=this._map._mapPane.className.replace(" leaflet-cluster-anim","")),this._inZoomAnimation--,this.fire("animationend")},_animationZoomIn:function(t,e){var i,o=this._getExpandedVisibleBounds(),s=this._featureGroup;this._topClusterLevel._recursively(o,t,0,function(n){var r,a=n._latlng,l=n._markers;for(o.contains(a)||(a=null),n._isSingleParent()&&t+1===e?(s.removeLayer(n),n._recursivelyAddChildrenToMap(null,e,o)):(n.setOpacity(0),n._recursivelyAddChildrenToMap(a,e,o)),i=l.length-1;i>=0;i--)r=l[i],o.contains(r._latlng)||s.removeLayer(r)}),this._forceLayout(),this._topClusterLevel._recursivelyBecomeVisible(o,e),s.eachLayer(function(t){t instanceof L.MarkerCluster||!t._icon||t.setOpacity(1)}),this._topClusterLevel._recursively(o,t,e,function(t){t._recursivelyRestoreChildPositions(e)}),this._enqueue(function(){this._topClusterLevel._recursively(o,t,0,function(t){s.removeLayer(t),t.setOpacity(1)}),this._animationEnd()})},_animationZoomOut:function(t,e){this._animationZoomOutSingle(this._topClusterLevel,t-1,e),this._topClusterLevel._recursivelyAddChildrenToMap(null,e,this._getExpandedVisibleBounds()),this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,t,this._getExpandedVisibleBounds())},_animationZoomOutSingle:function(t,e,i){var o=this._getExpandedVisibleBounds();t._recursivelyAnimateChildrenInAndAddSelfToMap(o,e+1,i);var s=this;this._forceLayout(),t._recursivelyBecomeVisible(o,i),this._enqueue(function(){if(1===t._childCount){var n=t._markers[0];n.setLatLng(n.getLatLng()),n.setOpacity(1)}else t._recursively(o,i,0,function(t){t._recursivelyRemoveChildrenFromMap(o,e+1)});s._animationEnd()})},_animationAddLayer:function(t,e){var i=this,o=this._featureGroup;o.addLayer(t),e!==t&&(e._childCount>2?(e._updateIcon(),this._forceLayout(),this._animationStart(),t._setPos(this._map.latLngToLayerPoint(e.getLatLng())),t.setOpacity(0),this._enqueue(function(){o.removeLayer(t),t.setOpacity(1),i._animationEnd()})):(this._forceLayout(),i._animationStart(),i._animationZoomOutSingle(e,this._map.getMaxZoom(),this._map.getZoom())))},_forceLayout:function(){L.Util.falseFn(e.body.offsetWidth)}}:{_animationStart:function(){},_animationZoomIn:function(t,e){this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,t),this._topClusterLevel._recursivelyAddChildrenToMap(null,e,this._getExpandedVisibleBounds())},_animationZoomOut:function(t,e){this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,t),this._topClusterLevel._recursivelyAddChildrenToMap(null,e,this._getExpandedVisibleBounds())},_animationAddLayer:function(t,e){this._animationAddLayerNonAnimated(t,e)}}),L.markerClusterGroup=function(t){return new L.MarkerClusterGroup(t)},L.MarkerCluster=L.Marker.extend({initialize:function(t,e,i,o){L.Marker.prototype.initialize.call(this,i?i._cLatLng||i.getLatLng():new L.LatLng(0,0),{icon:this}),this._group=t,this._zoom=e,this._markers=[],this._childClusters=[],this._childCount=0,this._iconNeedsUpdate=!0,this._bounds=new L.LatLngBounds,i&&this._addChild(i),o&&this._addChild(o)},getAllChildMarkers:function(t){t=t||[];for(var e=this._childClusters.length-1;e>=0;e--)this._childClusters[e].getAllChildMarkers(t);for(var i=this._markers.length-1;i>=0;i--)t.push(this._markers[i]);return t},getChildCount:function(){return this._childCount},zoomToBounds:function(){for(var t,e=this._childClusters.slice(),i=this._group._map,o=i.getBoundsZoom(this._bounds),s=this._zoom+1,n=i.getZoom();e.length>0&&o>s;){s++;var r=[];for(t=0;t<e.length;t++)r=r.concat(e[t]._childClusters);e=r}o>s?this._group._map.setView(this._latlng,s):n>=o?this._group._map.setView(this._latlng,n+1):this._group._map.fitBounds(this._bounds)},getBounds:function(){var t=new L.LatLngBounds;return t.extend(this._bounds),t},_updateIcon:function(){this._iconNeedsUpdate=!0,this._icon&&this.setIcon(this)},createIcon:function(){return this._iconNeedsUpdate&&(this._iconObj=this._group.options.iconCreateFunction(this),this._iconNeedsUpdate=!1),this._iconObj.createIcon()},createShadow:function(){return this._iconObj.createShadow()},_addChild:function(t,e){this._iconNeedsUpdate=!0,this._expandBounds(t),t instanceof L.MarkerCluster?(e||(this._childClusters.push(t),t.__parent=this),this._childCount+=t._childCount):(e||this._markers.push(t),this._childCount++),this.__parent&&this.__parent._addChild(t,!0)},_expandBounds:function(t){var e,i=t._wLatLng||t._latlng;t instanceof L.MarkerCluster?(this._bounds.extend(t._bounds),e=t._childCount):(this._bounds.extend(i),e=1),this._cLatLng||(this._cLatLng=t._cLatLng||i);var o=this._childCount+e;this._wLatLng?(this._wLatLng.lat=(i.lat*e+this._wLatLng.lat*this._childCount)/o,this._wLatLng.lng=(i.lng*e+this._wLatLng.lng*this._childCount)/o):this._latlng=this._wLatLng=new L.LatLng(i.lat,i.lng)},_addToMap:function(t){t&&(this._backupLatlng=this._latlng,this.setLatLng(t)),this._group._featureGroup.addLayer(this)},_recursivelyAnimateChildrenIn:function(t,e,i){this._recursively(t,0,i-1,function(t){var i,o,s=t._markers;for(i=s.length-1;i>=0;i--)o=s[i],o._icon&&(o._setPos(e),o.setOpacity(0))},function(t){var i,o,s=t._childClusters;for(i=s.length-1;i>=0;i--)o=s[i],o._icon&&(o._setPos(e),o.setOpacity(0))})},_recursivelyAnimateChildrenInAndAddSelfToMap:function(t,e,i){this._recursively(t,i,0,function(o){o._recursivelyAnimateChildrenIn(t,o._group._map.latLngToLayerPoint(o.getLatLng()).round(),e),o._isSingleParent()&&e-1===i?(o.setOpacity(1),o._recursivelyRemoveChildrenFromMap(t,e)):o.setOpacity(0),o._addToMap()})},_recursivelyBecomeVisible:function(t,e){this._recursively(t,0,e,null,function(t){t.setOpacity(1)})},_recursivelyAddChildrenToMap:function(t,e,i){this._recursively(i,-1,e,function(o){if(e!==o._zoom)for(var s=o._markers.length-1;s>=0;s--){var n=o._markers[s];i.contains(n._latlng)&&(t&&(n._backupLatlng=n.getLatLng(),n.setLatLng(t),n.setOpacity&&n.setOpacity(0)),o._group._featureGroup.addLayer(n))}},function(e){e._addToMap(t)})},_recursivelyRestoreChildPositions:function(t){for(var e=this._markers.length-1;e>=0;e--){var i=this._markers[e];i._backupLatlng&&(i.setLatLng(i._backupLatlng),delete i._backupLatlng)}if(t-1===this._zoom)for(var o=this._childClusters.length-1;o>=0;o--)this._childClusters[o]._restorePosition();else for(var s=this._childClusters.length-1;s>=0;s--)this._childClusters[s]._recursivelyRestoreChildPositions(t)},_restorePosition:function(){this._backupLatlng&&(this.setLatLng(this._backupLatlng),delete this._backupLatlng)},_recursivelyRemoveChildrenFromMap:function(t,e,i){var o,s;this._recursively(t,-1,e-1,function(t){for(s=t._markers.length-1;s>=0;s--)o=t._markers[s],i&&i.contains(o._latlng)||(t._group._featureGroup.removeLayer(o),o.setOpacity&&o.setOpacity(1))},function(t){for(s=t._childClusters.length-1;s>=0;s--)o=t._childClusters[s],i&&i.contains(o._latlng)||(t._group._featureGroup.removeLayer(o),o.setOpacity&&o.setOpacity(1))})},_recursively:function(t,e,i,o,s){var n,r,a=this._childClusters,l=this._zoom;if(e>l)for(n=a.length-1;n>=0;n--)r=a[n],t.intersects(r._bounds)&&r._recursively(t,e,i,o,s);else if(o&&o(this),s&&this._zoom===i&&s(this),i>l)for(n=a.length-1;n>=0;n--)r=a[n],t.intersects(r._bounds)&&r._recursively(t,e,i,o,s)},_recalculateBounds:function(){var t,e=this._markers,i=this._childClusters;for(this._bounds=new L.LatLngBounds,delete this._wLatLng,t=e.length-1;t>=0;t--)this._expandBounds(e[t]);for(t=i.length-1;t>=0;t--)this._expandBounds(i[t])},_isSingleParent:function(){return this._childClusters.length>0&&this._childClusters[0]._childCount===this._childCount}}),L.DistanceGrid=function(t){this._cellSize=t,this._sqCellSize=t*t,this._grid={},this._objectPoint={}},L.DistanceGrid.prototype={addObject:function(t,e){var i=this._getCoord(e.x),o=this._getCoord(e.y),s=this._grid,n=s[o]=s[o]||{},r=n[i]=n[i]||[],a=L.Util.stamp(t);this._objectPoint[a]=e,r.push(t)},updateObject:function(t,e){this.removeObject(t),this.addObject(t,e)},removeObject:function(t,e){var i,o,s=this._getCoord(e.x),n=this._getCoord(e.y),r=this._grid,a=r[n]=r[n]||{},l=a[s]=a[s]||[];for(delete this._objectPoint[L.Util.stamp(t)],i=0,o=l.length;o>i;i++)if(l[i]===t)return l.splice(i,1),1===o&&delete a[s],!0},eachObject:function(t,e){var i,o,s,n,r,a,l,h=this._grid;for(i in h){r=h[i];for(o in r)for(a=r[o],s=0,n=a.length;n>s;s++)l=t.call(e,a[s]),l&&(s--,n--)}},getNearObject:function(t){var e,i,o,s,n,r,a,l,h=this._getCoord(t.x),p=this._getCoord(t.y),c=this._objectPoint,d=this._sqCellSize,u=null;for(e=p-1;p+1>=e;e++)if(s=this._grid[e])for(i=h-1;h+1>=i;i++)if(n=s[i])for(o=0,r=n.length;r>o;o++)a=n[o],l=this._sqDist(c[L.Util.stamp(a)],t),d>l&&(d=l,u=a);return u},_getCoord:function(t){return Math.floor(t/this._cellSize)},_sqDist:function(t,e){var i=e.x-t.x,o=e.y-t.y;return i*i+o*o}},function(){L.QuickHull={getDistant:function(t,e){var i=e[1].lat-e[0].lat,o=e[0].lng-e[1].lng;return o*(t.lat-e[0].lat)+i*(t.lng-e[0].lng)},findMostDistantPointFromBaseLine:function(t,e){var i,o,s,n=0,r=null,a=[];for(i=e.length-1;i>=0;i--)o=e[i],s=this.getDistant(o,t),s>0&&(a.push(o),s>n&&(n=s,r=o));return{maxPoint:r,newPoints:a}},buildConvexHull:function(t,e){var i=[],o=this.findMostDistantPointFromBaseLine(t,e);return o.maxPoint?(i=i.concat(this.buildConvexHull([t[0],o.maxPoint],o.newPoints)),i=i.concat(this.buildConvexHull([o.maxPoint,t[1]],o.newPoints))):[t[0]]},getConvexHull:function(t){var e,i=!1,o=!1,s=null,n=null;for(e=t.length-1;e>=0;e--){var r=t[e];(i===!1||r.lat>i)&&(s=r,i=r.lat),(o===!1||r.lat<o)&&(n=r,o=r.lat)}var a=[].concat(this.buildConvexHull([n,s],t),this.buildConvexHull([s,n],t));return a}}}(),L.MarkerCluster.include({getConvexHull:function(){var t,e,i=this.getAllChildMarkers(),o=[];for(e=i.length-1;e>=0;e--)t=i[e].getLatLng(),o.push(t);return L.QuickHull.getConvexHull(o)}}),L.MarkerCluster.include({_2PI:2*Math.PI,_circleFootSeparation:25,_circleStartAngle:Math.PI/6,_spiralFootSeparation:28,_spiralLengthStart:11,_spiralLengthFactor:5,_circleSpiralSwitchover:9,spiderfy:function(){if(this._group._spiderfied!==this&&!this._group._inZoomAnimation){var t,e=this.getAllChildMarkers(),i=this._group,o=i._map,s=o.latLngToLayerPoint(this._latlng);this._group._unspiderfy(),this._group._spiderfied=this,e.length>=this._circleSpiralSwitchover?t=this._generatePointsSpiral(e.length,s):(s.y+=10,t=this._generatePointsCircle(e.length,s)),this._animationSpiderfy(e,t)}},unspiderfy:function(t){this._group._inZoomAnimation||(this._animationUnspiderfy(t),this._group._spiderfied=null)},_generatePointsCircle:function(t,e){var i,o,s=this._group.options.spiderfyDistanceMultiplier*this._circleFootSeparation*(2+t),n=s/this._2PI,r=this._2PI/t,a=[];for(a.length=t,i=t-1;i>=0;i--)o=this._circleStartAngle+i*r,a[i]=new L.Point(e.x+n*Math.cos(o),e.y+n*Math.sin(o))._round();return a},_generatePointsSpiral:function(t,e){var i,o=this._group.options.spiderfyDistanceMultiplier*this._spiralLengthStart,s=this._group.options.spiderfyDistanceMultiplier*this._spiralFootSeparation,n=this._group.options.spiderfyDistanceMultiplier*this._spiralLengthFactor,r=0,a=[];for(a.length=t,i=t-1;i>=0;i--)r+=s/o+5e-4*i,a[i]=new L.Point(e.x+o*Math.cos(r),e.y+o*Math.sin(r))._round(),o+=this._2PI*n/r;return a},_noanimationUnspiderfy:function(){var t,e,i=this._group,o=i._map,s=i._featureGroup,n=this.getAllChildMarkers();for(this.setOpacity(1),e=n.length-1;e>=0;e--)t=n[e],s.removeLayer(t),t._preSpiderfyLatlng&&(t.setLatLng(t._preSpiderfyLatlng),delete t._preSpiderfyLatlng),t.setZIndexOffset&&t.setZIndexOffset(0),t._spiderLeg&&(o.removeLayer(t._spiderLeg),delete t._spiderLeg);i._spiderfied=null}}),L.MarkerCluster.include(L.DomUtil.TRANSITION?{SVG_ANIMATION:function(){return e.createElementNS("http://www.w3.org/2000/svg","animate").toString().indexOf("SVGAnimate")>-1}(),_animationSpiderfy:function(t,i){var o,s,n,r,a=this,l=this._group,h=l._map,p=l._featureGroup,c=h.latLngToLayerPoint(this._latlng);for(o=t.length-1;o>=0;o--)s=t[o],s.setOpacity?(s.setZIndexOffset(1e6),s.setOpacity(0),p.addLayer(s),s._setPos(c)):p.addLayer(s);l._forceLayout(),l._animationStart();var d=L.Path.SVG?0:.3,u=L.Path.SVG_NS;for(o=t.length-1;o>=0;o--)if(r=h.layerPointToLatLng(i[o]),s=t[o],s._preSpiderfyLatlng=s._latlng,s.setLatLng(r),s.setOpacity&&s.setOpacity(1),n=new L.Polyline([a._latlng,r],{weight:1.5,color:"#222",opacity:d}),h.addLayer(n),s._spiderLeg=n,L.Path.SVG&&this.SVG_ANIMATION){var _=n._path.getTotalLength();n._path.setAttribute("stroke-dasharray",_+","+_);var f=e.createElementNS(u,"animate");f.setAttribute("attributeName","stroke-dashoffset"),f.setAttribute("begin","indefinite"),f.setAttribute("from",_),f.setAttribute("to",0),f.setAttribute("dur",.25),n._path.appendChild(f),f.beginElement(),f=e.createElementNS(u,"animate"),f.setAttribute("attributeName","stroke-opacity"),f.setAttribute("attributeName","stroke-opacity"),f.setAttribute("begin","indefinite"),f.setAttribute("from",0),f.setAttribute("to",.5),f.setAttribute("dur",.25),n._path.appendChild(f),f.beginElement()}if(a.setOpacity(.3),L.Path.SVG)for(this._group._forceLayout(),o=t.length-1;o>=0;o--)s=t[o]._spiderLeg,s.options.opacity=.5,s._path.setAttribute("stroke-opacity",.5);setTimeout(function(){l._animationEnd(),l.fire("spiderfied")},200)},_animationUnspiderfy:function(t){var e,i,o,s=this._group,n=s._map,r=s._featureGroup,a=t?n._latLngToNewLayerPoint(this._latlng,t.zoom,t.center):n.latLngToLayerPoint(this._latlng),l=this.getAllChildMarkers(),h=L.Path.SVG&&this.SVG_ANIMATION;for(s._animationStart(),this.setOpacity(1),i=l.length-1;i>=0;i--)e=l[i],e._preSpiderfyLatlng&&(e.setLatLng(e._preSpiderfyLatlng),delete e._preSpiderfyLatlng,e.setOpacity?(e._setPos(a),e.setOpacity(0)):r.removeLayer(e),h&&(o=e._spiderLeg._path.childNodes[0],o.setAttribute("to",o.getAttribute("from")),o.setAttribute("from",0),
o.beginElement(),o=e._spiderLeg._path.childNodes[1],o.setAttribute("from",.5),o.setAttribute("to",0),o.setAttribute("stroke-opacity",0),o.beginElement(),e._spiderLeg._path.setAttribute("stroke-opacity",0)));setTimeout(function(){var t=0;for(i=l.length-1;i>=0;i--)e=l[i],e._spiderLeg&&t++;for(i=l.length-1;i>=0;i--)e=l[i],e._spiderLeg&&(e.setOpacity&&(e.setOpacity(1),e.setZIndexOffset(0)),t>1&&r.removeLayer(e),n.removeLayer(e._spiderLeg),delete e._spiderLeg);s._animationEnd()},200)}}:{_animationSpiderfy:function(t,e){var i,o,s,n,r=this._group,a=r._map,l=r._featureGroup;for(i=t.length-1;i>=0;i--)n=a.layerPointToLatLng(e[i]),o=t[i],o._preSpiderfyLatlng=o._latlng,o.setLatLng(n),o.setZIndexOffset&&o.setZIndexOffset(1e6),l.addLayer(o),s=new L.Polyline([this._latlng,n],{weight:1.5,color:"#222"}),a.addLayer(s),o._spiderLeg=s;this.setOpacity(.3),r.fire("spiderfied")},_animationUnspiderfy:function(){this._noanimationUnspiderfy()}}),L.MarkerClusterGroup.include({_spiderfied:null,_spiderfierOnAdd:function(){this._map.on("click",this._unspiderfyWrapper,this),this._map.options.zoomAnimation&&this._map.on("zoomstart",this._unspiderfyZoomStart,this),this._map.on("zoomend",this._noanimationUnspiderfy,this),L.Path.SVG&&!L.Browser.touch&&this._map._initPathRoot()},_spiderfierOnRemove:function(){this._map.off("click",this._unspiderfyWrapper,this),this._map.off("zoomstart",this._unspiderfyZoomStart,this),this._map.off("zoomanim",this._unspiderfyZoomAnim,this),this._unspiderfy()},_unspiderfyZoomStart:function(){this._map&&this._map.on("zoomanim",this._unspiderfyZoomAnim,this)},_unspiderfyZoomAnim:function(t){L.DomUtil.hasClass(this._map._mapPane,"leaflet-touching")||(this._map.off("zoomanim",this._unspiderfyZoomAnim,this),this._unspiderfy(t))},_unspiderfyWrapper:function(){this._unspiderfy()},_unspiderfy:function(t){this._spiderfied&&this._spiderfied.unspiderfy(t)},_noanimationUnspiderfy:function(){this._spiderfied&&this._spiderfied._noanimationUnspiderfy()},_unspiderfyLayer:function(t){t._spiderLeg&&(this._featureGroup.removeLayer(t),t.setOpacity(1),t.setZIndexOffset(0),this._map.removeLayer(t._spiderLeg),delete t._spiderLeg)}})}(window,document),function(t,e,i){"use strict";L.AwesomeMarkers={},L.AwesomeMarkers.version="2.0.1",L.AwesomeMarkers.Icon=L.Icon.extend({options:{iconSize:[35,45],iconAnchor:[17,42],popupAnchor:[1,-32],shadowAnchor:[10,12],shadowSize:[36,16],className:"awesome-marker",prefix:"glyphicon",spinClass:"fa-spin",extraClasses:"",icon:"home",markerColor:"blue",iconColor:"white"},initialize:function(t){t=L.Util.setOptions(this,t)},createIcon:function(){var t=e.createElement("div"),i=this.options;return i.icon&&(t.innerHTML=this._createInner()),i.bgPos&&(t.style.backgroundPosition=-i.bgPos.x+"px "+-i.bgPos.y+"px"),this._setIconStyles(t,"icon-"+i.markerColor),t},_createInner:function(){var t,e="",i="",o="",s=this.options;return t=s.icon.slice(0,s.prefix.length+1)===s.prefix+"-"?s.icon:s.prefix+"-"+s.icon,s.spin&&"string"==typeof s.spinClass&&(e=s.spinClass),s.iconColor&&("white"===s.iconColor||"black"===s.iconColor?i="icon-"+s.iconColor:o="style='color: "+s.iconColor+"' "),"<i "+o+"class='"+s.extraClasses+" "+s.prefix+" "+t+" "+e+" "+i+"'></i>"},_setIconStyles:function(t,e){var i,o=this.options,s=L.point(o["shadow"===e?"shadowSize":"iconSize"]);i="shadow"===e?L.point(o.shadowAnchor||o.iconAnchor):L.point(o.iconAnchor),!i&&s&&(i=s.divideBy(2,!0)),t.className="awesome-marker-"+e+" "+o.className,i&&(t.style.marginLeft=-i.x+"px",t.style.marginTop=-i.y+"px"),s&&(t.style.width=s.x+"px",t.style.height=s.y+"px")},createShadow:function(){var t=e.createElement("div");return this._setIconStyles(t,"shadow"),t}}),L.AwesomeMarkers.icon=function(t){return new L.AwesomeMarkers.Icon(t)}}(this,document),function(t,e,i){"use strict";L.ExtraMarkers={},L.ExtraMarkers.version="1.0.1",L.ExtraMarkers.Icon=L.Icon.extend({options:{iconSize:[35,45],iconAnchor:[17,42],popupAnchor:[1,-32],shadowAnchor:[10,12],shadowSize:[36,16],className:"extra-marker",prefix:"",extraClasses:"",shape:"circle",icon:"",markerColor:"red",iconColor:"#fff"},initialize:function(t){t=L.Util.setOptions(this,t)},createIcon:function(){var t=e.createElement("div"),i=this.options;return i.icon&&(t.innerHTML=this._createInner()),i.bgPos&&(t.style.backgroundPosition=-i.bgPos.x+"px "+-i.bgPos.y+"px"),this._setIconStyles(t,i.shape+"-"+i.markerColor),t},_createInner:function(){var t="",e=this.options;return e.iconColor&&(t="style='color: "+e.iconColor+"' "),"<i "+t+"class='"+e.extraClasses+" "+e.prefix+" "+e.icon+"'></i>"},_setIconStyles:function(t,e){var i,o=this.options,s=L.point(o["shadow"===e?"shadowSize":"iconSize"]);i="shadow"===e?L.point(o.shadowAnchor||o.iconAnchor):L.point(o.iconAnchor),!i&&s&&(i=s.divideBy(2,!0)),t.className="extra-marker-"+e+" "+o.className,i&&(t.style.marginLeft=-i.x+"px",t.style.marginTop=-i.y+"px"),s&&(t.style.width=s.x+"px",t.style.height=s.y+"px")},createShadow:function(){var t=e.createElement("div");return this._setIconStyles(t,"shadow"),t}}),L.ExtraMarkers.icon=function(t){return new L.ExtraMarkers.Icon(t)}}(this,document),!function(t,e){"function"==typeof define&&define.amd?define(["leaflet"],t):"object"==typeof exports&&(module.exports=t("undefined"!=typeof e&&e.L?L:require("leaflet"))),"undefined"!=typeof e&&e.L&&(e.L.Locate=t(L))}(function(t){return t.Control.Locate=t.Control.extend({options:{position:"topleft",drawCircle:!0,follow:!1,stopFollowingOnDrag:!1,remainActive:!1,markerClass:t.circleMarker,circleStyle:{color:"#136AEC",fillColor:"#136AEC",fillOpacity:.15,weight:2,opacity:.5},markerStyle:{color:"#136AEC",fillColor:"#2A93EE",fillOpacity:.7,weight:2,opacity:.9,radius:5},followCircleStyle:{},followMarkerStyle:{},icon:"fa fa-map-marker",iconLoading:"fa fa-spinner fa-spin",circlePadding:[0,0],metric:!0,onLocationError:function(t){alert(t.message)},onLocationOutsideMapBounds:function(t){t.stop(),alert(t.options.strings.outsideMapBoundsMsg)},setView:!0,keepCurrentZoomLevel:!1,showPopup:!0,strings:{title:"Show me where I am",popup:"You are within {distance} {unit} from this point",outsideMapBoundsMsg:"You seem located outside the boundaries of the map"},locateOptions:{maxZoom:1/0,watch:!0}},initialize:function(e){t.Map.addInitHook(function(){this.options.locateControl&&(this.locateControl=t.control.locate(),this.addControl(this.locateControl))});for(var i in e)"object"==typeof this.options[i]?t.extend(this.options[i],e[i]):this.options[i]=e[i];t.extend(this.options.locateOptions,{setView:!1})},_activate:function(){this.options.setView&&(this._locateOnNextLocationFound=!0),this._active||this._map.locate(this.options.locateOptions),this._active=!0,this.options.follow&&this._startFollowing(this._map)},_deactivate:function(){this._map.stopLocate(),this._map.off("dragstart",this._stopFollowing),this.options.follow&&this._following&&this._stopFollowing(this._map)},drawMarker:function(e){void 0===this._event.accuracy&&(this._event.accuracy=0);var i=this._event.accuracy;this._locateOnNextLocationFound&&(this._isOutsideMapBounds()?this.options.onLocationOutsideMapBounds(this):e.fitBounds(this._event.bounds,{padding:this.options.circlePadding,maxZoom:this.options.keepCurrentZoomLevel?e.getZoom():this.options.locateOptions.maxZoom}),this._locateOnNextLocationFound=!1);var o,s;if(this.options.drawCircle)if(o=this._following?this.options.followCircleStyle:this.options.circleStyle,this._circle){this._circle.setLatLng(this._event.latlng).setRadius(i);for(s in o)this._circle.options[s]=o[s]}else this._circle=t.circle(this._event.latlng,i,o).addTo(this._layer);var n,r;this.options.metric?(n=i.toFixed(0),r="meters"):(n=(3.2808399*i).toFixed(0),r="feet");var a;a=this._following?this.options.followMarkerStyle:this.options.markerStyle,this._marker?this.updateMarker(this._event.latlng,a):this._marker=this.createMarker(this._event.latlng,a).addTo(this._layer);var l=this.options.strings.popup;this.options.showPopup&&l&&this._marker.bindPopup(t.Util.template(l,{distance:n,unit:r}))._popup.setLatLng(this._event.latlng),this._toggleContainerStyle()},createMarker:function(t,e){return this.options.markerClass(t,e)},updateMarker:function(t,e){this._marker.setLatLng(t);for(o in e)this._marker.options[o]=e[o]},removeMarker:function(){this._layer.clearLayers(),this._marker=void 0,this._circle=void 0},onAdd:function(e){var i=t.DomUtil.create("div","leaflet-control-locate leaflet-bar leaflet-control");this._layer=new t.LayerGroup,this._layer.addTo(e),this._event=void 0;var o={};return t.extend(o,this.options.markerStyle,this.options.followMarkerStyle),this.options.followMarkerStyle=o,o={},t.extend(o,this.options.circleStyle,this.options.followCircleStyle),this.options.followCircleStyle=o,this._link=t.DomUtil.create("a","leaflet-bar-part leaflet-bar-part-single",i),this._link.href="#",this._link.title=this.options.strings.title,this._icon=t.DomUtil.create("span",this.options.icon,this._link),t.DomEvent.on(this._link,"click",t.DomEvent.stopPropagation).on(this._link,"click",t.DomEvent.preventDefault).on(this._link,"click",function(){var t=void 0===this._event||this._map.getBounds().contains(this._event.latlng)||!this.options.setView||this._isOutsideMapBounds();!this.options.remainActive&&this._active&&t?this.stop():this.start()},this).on(this._link,"dblclick",t.DomEvent.stopPropagation),this._resetVariables(),this.bindEvents(e),i},bindEvents:function(t){t.on("locationfound",this._onLocationFound,this),t.on("locationerror",this._onLocationError,this),t.on("unload",this.stop,this)},start:function(){this._activate(),this._event?this.drawMarker(this._map):this._setClasses("requesting")},stop:function(){this._deactivate(),this._cleanClasses(),this._resetVariables(),this.removeMarker()},_onLocationError:function(t){3==t.code&&this.options.locateOptions.watch||(this.stop(),this.options.onLocationError(t))},_onLocationFound:function(t){this._event&&this._event.latlng.lat===t.latlng.lat&&this._event.latlng.lng===t.latlng.lng&&this._event.accuracy===t.accuracy||this._active&&(this._event=t,this.options.follow&&this._following&&(this._locateOnNextLocationFound=!0),this.drawMarker(this._map))},_startFollowing:function(){this._map.fire("startfollowing",this),this._following=!0,this.options.stopFollowingOnDrag&&this._map.on("dragstart",this._stopFollowing,this)},_stopFollowing:function(){this._map.fire("stopfollowing",this),this._following=!1,this.options.stopFollowingOnDrag&&this._map.off("dragstart",this._stopFollowing),this._toggleContainerStyle()},_isOutsideMapBounds:function(){return void 0===this._event?!1:this._map.options.maxBounds&&!this._map.options.maxBounds.contains(this._event.latlng)},_toggleContainerStyle:function(){this._container&&this._setClasses(this._following?"following":"active")},_setClasses:function(e){"requesting"==e?(t.DomUtil.removeClasses(this._container,"active following"),t.DomUtil.addClasses(this._container,"requesting"),t.DomUtil.removeClasses(this._icon,this.options.icon),t.DomUtil.addClasses(this._icon,this.options.iconLoading)):"active"==e?(t.DomUtil.removeClasses(this._container,"requesting following"),t.DomUtil.addClasses(this._container,"active"),t.DomUtil.removeClasses(this._icon,this.options.iconLoading),t.DomUtil.addClasses(this._icon,this.options.icon)):"following"==e&&(t.DomUtil.removeClasses(this._container,"requesting"),t.DomUtil.addClasses(this._container,"active following"),t.DomUtil.removeClasses(this._icon,this.options.iconLoading),t.DomUtil.addClasses(this._icon,this.options.icon))},_cleanClasses:function(){t.DomUtil.removeClass(this._container,"requesting"),t.DomUtil.removeClass(this._container,"active"),t.DomUtil.removeClass(this._container,"following"),t.DomUtil.removeClasses(this._icon,this.options.iconLoading),t.DomUtil.addClasses(this._icon,this.options.icon)},_resetVariables:function(){this._active=!1,this._locateOnNextLocationFound=this.options.setView,this._following=!1}}),t.Map.addInitHook(function(){this.options.locateControl&&(this.locateControl=t.control.locate(),this.addControl(this.locateControl))}),t.control.locate=function(e){return new t.Control.Locate(e)},function(){var e=function(e,i,o){o=o.split(" "),o.forEach(function(o){t.DomUtil[e].call(this,i,o)})};t.DomUtil.addClasses=function(t,i){e("addClass",t,i)},t.DomUtil.removeClasses=function(t,i){e("removeClass",t,i)}}(),t.Control.Locate},window),function(t){t.lvector={VERSION:"1.5.1",noConflict:function(){return t.lvector=this._originallvector,this},_originallvector:t.lvector}}(this),lvector.Layer=L.Class.extend({options:{fields:"",scaleRange:null,map:null,uniqueField:null,visibleAtScale:!0,dynamic:!1,autoUpdate:!1,autoUpdateInterval:null,popupTemplate:null,popupOptions:{},singlePopup:!1,symbology:null,showAll:!1},initialize:function(t){L.Util.setOptions(this,t)},setMap:function(t){if(!t||!this.options.map)if(t){if(this.options.map=t,this.options.scaleRange&&this.options.scaleRange instanceof Array&&2===this.options.scaleRange.length){var t=this.options.map.getZoom(),e=this.options.scaleRange;this.options.visibleAtScale=t>=e[0]&&t<=e[1]}this._show()}else this.options.map&&(this._hide(),this.options.map=t)},getMap:function(){return this.options.map},setOptions:function(){},_show:function(){if(this._addIdleListener(),this.options.scaleRange&&this.options.scaleRange instanceof Array&&2===this.options.scaleRange.length&&this._addZoomChangeListener(),this.options.visibleAtScale){if(this.options.autoUpdate&&this.options.autoUpdateInterval){var t=this;this._autoUpdateInterval=setInterval(function(){t._getFeatures()},this.options.autoUpdateInterval)}this.options.map.fire("moveend").fire("zoomend")}},_hide:function(){this._idleListener&&this.options.map.off("moveend",this._idleListener),this._zoomChangeListener&&this.options.map.off("zoomend",this._zoomChangeListener),this._autoUpdateInterval&&clearInterval(this._autoUpdateInterval),this._clearFeatures(),this._lastQueriedBounds=null,this._gotAll&&(this._gotAll=!1)},_hideVectors:function(){for(var t=0;t<this._vectors.length;t++)if(this._vectors[t].vector&&(this.options.map.removeLayer(this._vectors[t].vector),this._vectors[t].popup?this.options.map.removeLayer(this._vectors[t].popup):this.popup&&this.popup.associatedFeature&&this.popup.associatedFeature==this._vectors[t]&&(this.options.map.removeLayer(this.popup),this.popup=null)),this._vectors[t].vectors&&this._vectors[t].vectors.length)for(var e=0;e<this._vectors[t].vectors.length;e++)this.options.map.removeLayer(this._vectors[t].vectors[e]),this._vectors[t].vectors[e].popup?this.options.map.removeLayer(this._vectors[t].vectors[e].popup):this.popup&&this.popup.associatedFeature&&this.popup.associatedFeature==this._vectors[t]&&(this.options.map.removeLayer(this.popup),this.popup=null)},_showVectors:function(){for(var t=0;t<this._vectors.length;t++)if(this._vectors[t].vector&&this.options.map.addLayer(this._vectors[t].vector),this._vectors[t].vectors&&this._vectors[t].vectors.length)for(var e=0;e<this._vectors[t].vectors.length;e++)this.options.map.addLayer(this._vectors[t].vectors[e])},_clearFeatures:function(){this._hideVectors(),this._vectors=[]},_addZoomChangeListener:function(){this._zoomChangeListener=this._zoomChangeListenerTemplate(),this.options.map.on("zoomend",this._zoomChangeListener,this)},_zoomChangeListenerTemplate:function(){var t=this;return function(){t._checkLayerVisibility()}},_idleListenerTemplate:function(){var t=this;return function(){t.options.visibleAtScale&&(t.options.showAll?t._gotAll||(t._getFeatures(),t._gotAll=!0):t._getFeatures())}},_addIdleListener:function(){this._idleListener=this._idleListenerTemplate(),this.options.map.on("moveend",this._idleListener,this)},_checkLayerVisibility:function(){var t=this.options.visibleAtScale,e=this.options.map.getZoom(),i=this.options.scaleRange;if(this.options.visibleAtScale=e>=i[0]&&e<=i[1],t!==this.options.visibleAtScale&&this[this.options.visibleAtScale?"_showVectors":"_hideVectors"](),t&&!this.options.visibleAtScale&&this._autoUpdateInterval)clearInterval(this._autoUpdateInterval);else if(!t&&this.options.autoUpdate&&this.options.autoUpdateInterval){var o=this;this._autoUpdateInterval=setInterval(function(){o._getFeatures()},this.options.autoUpdateInterval)}},_setPopupContent:function(t){var e,i=t.popupContent,o=t.attributes||t.properties;if("string"==typeof this.options.popupTemplate){e=this.options.popupTemplate;for(var s in o)e=e.replace(RegExp("{"+s+"}","g"),o[s])}else{if("function"!=typeof this.options.popupTemplate)return;e=this.options.popupTemplate(o)}t.popupContent=e,t.popup?t.popupContent!==i&&t.popup.setContent(t.popupContent):this.popup&&this.popup.associatedFeature==t&&t.popupContent!==i&&this.popup.setContent(t.popupContent)},_showPopup:function(t,e){var i=e.latlng;i||L.Util.extend(this.options.popupOptions,{offset:e.target.options.icon.options.popupAnchor});var o;this.options.singlePopup?(this.popup&&(this.options.map.removeLayer(this.popup),this.popup=null),this.popup=new L.Popup(this.options.popupOptions,t.vector),this.popup.associatedFeature=t,o=this):(t.popup=new L.Popup(this.options.popupOptions,t.vector),o=t),o.popup.setLatLng(i?e.latlng:e.target.getLatLng()),o.popup.setContent(t.popupContent),this.options.map.addLayer(o.popup)},_fireClickEvent:function(t,e){this.options.clickEvent(t,e)},_getFeatureVectorOptions:function(t){var e={},t=t.attributes||t.properties;if(this.options.symbology)switch(this.options.symbology.type){case"single":for(var i in this.options.symbology.vectorOptions)if(e[i]=this.options.symbology.vectorOptions[i],e.title)for(var o in t){var s=RegExp("{"+o+"}","g");e.title=e.title.replace(s,t[o])}break;case"unique":for(var n=this.options.symbology.property,r=0,a=this.options.symbology.values.length;a>r;r++)if(t[n]==this.options.symbology.values[r].value)for(i in this.options.symbology.values[r].vectorOptions)if(e[i]=this.options.symbology.values[r].vectorOptions[i],e.title)for(o in t)s=RegExp("{"+o+"}","g"),e.title=e.title.replace(s,t[o]);break;case"range":for(n=this.options.symbology.property,r=0,a=this.options.symbology.ranges.length;a>r;r++)if(t[n]>=this.options.symbology.ranges[r].range[0]&&t[n]<=this.options.symbology.ranges[r].range[1])for(i in this.options.symbology.ranges[r].vectorOptions)if(e[i]=this.options.symbology.ranges[r].vectorOptions[i],e.title)for(o in t)s=RegExp("{"+o+"}","g"),e.title=e.title.replace(s,t[o])}return e},_getPropertiesChanged:function(t,e){var i,o=!1;for(i in t)t[i]!=e[i]&&(o=!0);return o},_getPropertyChanged:function(t,e,i){return t[i]!=e[i]},_getGeometryChanged:function(t,e){var i=!1;return t.coordinates&&t.coordinates instanceof Array?t.coordinates[0]==e.coordinates[0]&&t.coordinates[1]==e.coordinates[1]||(i=!0):t.x==e.x&&t.y==e.y||(i=!0),i},_makeJsonpRequest:function(t){var e=document.getElementsByTagName("head")[0],i=document.createElement("script");i.type="text/javascript",i.src=t,e.appendChild(i)},_processFeatures:function(t){if(this.options.map){var e=this.options.map.getBounds();if(!this._lastQueriedBounds||!this._lastQueriedBounds.equals(e)||this.options.autoUpdate){if(this._lastQueriedBounds=e,featuresHaveIds=t.features&&t.features.length&&t.features[0].id?!0:!1,!this.options.uniqueField&&!featuresHaveIds&&this._clearFeatures(),this instanceof lvector.PRWSF){t.features=t.rows,delete t.rows;for(var e=0,i=t.features.length;i>e;e++){t.features[e].type="Feature",t.features[e].properties={};for(var o in t.features[e].row)"geojson"==o?t.features[e].geometry=t.features[e].row.geojson:t.features[e].properties[o]=t.features[e].row[o];delete t.features[e].row}}if(this instanceof lvector.GISCloud)for(t.features=t.data,delete t.data,e=0,i=t.features.length;i>e;e++)t.features[e].type="Feature",t.features[e].properties=t.features[e].data,t.features[e].properties.id=t.features[e].__id,delete t.features[e].data,t.features[e].geometry=t.features[e].__geometry,delete t.features[e].__geometry;if(t&&t.features&&t.features.length)for(e=0;e<t.features.length;e++){if(this instanceof lvector.EsriJSONLayer&&(t.features[e].properties=t.features[e].attributes,delete t.features[e].attributes),o=!1,i=t.features[e].id?!0:!1,this.options.uniqueField||i)for(var s=0;s<this._vectors.length;s++){var n=this._vectors[s].id?!0:!1;if((i&&n&&t.features[e].id==this._vectors[s].id||this.options.uniqueField&&t.features[e].properties[this.options.uniqueField]==this._vectors[s].properties[this.options.uniqueField])&&(o=!0,this.options.dynamic&&(!this._getGeometryChanged(this._vectors[s].geometry,t.features[e].geometry)||isNaN(t.features[e].geometry.coordinates[0])||isNaN(t.features[e].geometry.coordinates[1])||(this._vectors[s].geometry=t.features[e].geometry,this._vectors[s].vector.setLatLng(new L.LatLng(this._vectors[s].geometry.coordinates[1],this._vectors[s].geometry.coordinates[0]))),this._getPropertiesChanged(this._vectors[s].properties,t.features[e].properties)&&(n=this._getPropertyChanged(this._vectors[s].properties,t.features[e].properties,this.options.symbology.property),this._vectors[s].properties=t.features[e].properties,this.options.popupTemplate&&this._setPopupContent(this._vectors[s]),this.options.symbology&&"single"!=this.options.symbology.type&&n))))if(this._vectors[s].vectors)for(var n=0,r=this._vectors[s].vectors.length;r>n;n++)this._vectors[s].vectors[n].setStyle?this._vectors[s].vectors[n].setStyle(this._getFeatureVectorOptions(this._vectors[s])):this._vectors[s].vectors[n].setIcon&&this._vectors[s].vectors[n].setIcon(this._getFeatureVectorOptions(this._vectors[s]).icon);else this._vectors[s].vector&&(this._vectors[s].vector.setStyle?this._vectors[s].vector.setStyle(this._getFeatureVectorOptions(this._vectors[s])):this._vectors[s].vector.setIcon&&this._vectors[s].vector.setIcon(this._getFeatureVectorOptions(this._vectors[s]).icon))}if(!o){if(this instanceof lvector.GeoJSONLayer?(o=this._geoJsonGeometryToLeaflet(t.features[e].geometry,this._getFeatureVectorOptions(t.features[e])),t.features[e][o instanceof Array?"vectors":"vector"]=o):this instanceof lvector.EsriJSONLayer&&(o=this._esriJsonGeometryToLeaflet(t.features[e].geometry,this._getFeatureVectorOptions(t.features[e])),t.features[e][o instanceof Array?"vectors":"vector"]=o),t.features[e].vector)this.options.map.addLayer(t.features[e].vector);else if(t.features[e].vectors&&t.features[e].vectors.length)for(n=0;n<t.features[e].vectors.length;n++)this.options.map.addLayer(t.features[e].vectors[n]);if(this._vectors.push(t.features[e]),this.options.popupTemplate){var a=this;o=t.features[e],this._setPopupContent(o),function(t){if(t.vector)t.vector.on("click",function(e){a._showPopup(t,e)});else if(t.vectors)for(var e=0,i=t.vectors.length;i>e;e++)t.vectors[e].on("click",function(e){a._showPopup(t,e)})}(o)}this.options.clickEvent&&(a=this,o=t.features[e],function(t){if(t.vector)t.vector.on("click",function(e){a._fireClickEvent(t,e)});else if(t.vectors)for(var e=0,i=t.vectors.length;i>e;e++)t.vectors[e].on("click",function(e){a._fireClickEvent(t,e)})}(o))}}}}}}),lvector.GeoJSONLayer=lvector.Layer.extend({_geoJsonGeometryToLeaflet:function(t,e){var i,o;switch(t.type){case"Point":i=e.circleMarker?new L.CircleMarker(new L.LatLng(t.coordinates[1],t.coordinates[0]),e):new L.Marker(new L.LatLng(t.coordinates[1],t.coordinates[0]),e);break;case"MultiPoint":o=[];for(var s=0,n=t.coordinates.length;n>s;s++)o.push(new L.Marker(new L.LatLng(t.coordinates[s][1],t.coordinates[s][0]),e));break;case"LineString":for(var r=[],s=0,n=t.coordinates.length;n>s;s++)r.push(new L.LatLng(t.coordinates[s][1],t.coordinates[s][0]));i=new L.Polyline(r,e);break;case"MultiLineString":for(o=[],s=0,n=t.coordinates.length;n>s;s++){for(var r=[],a=0,l=t.coordinates[s].length;l>a;a++)r.push(new L.LatLng(t.coordinates[s][a][1],t.coordinates[s][a][0]));o.push(new L.Polyline(r,e))}break;case"Polygon":for(var h=[],s=0,n=t.coordinates.length;n>s;s++){for(r=[],a=0,l=t.coordinates[s].length;l>a;a++)r.push(new L.LatLng(t.coordinates[s][a][1],t.coordinates[s][a][0]));h.push(r)}i=new L.Polygon(h,e);break;case"MultiPolygon":for(o=[],s=0,n=t.coordinates.length;n>s;s++){for(h=[],a=0,l=t.coordinates[s].length;l>a;a++){for(var r=[],p=0,c=t.coordinates[s][a].length;c>p;p++)r.push(new L.LatLng(t.coordinates[s][a][p][1],t.coordinates[s][a][p][0]));h.push(r)}o.push(new L.Polygon(h,e))}break;case"GeometryCollection":for(o=[],s=0,n=t.geometries.length;n>s;s++)o.push(this._geoJsonGeometryToLeaflet(t.geometries[s],e))}return i||o}}),lvector.EsriJSONLayer=lvector.Layer.extend({_esriJsonGeometryToLeaflet:function(t,e){var i,o;if(t.x&&t.y)i=new L.Marker(new L.LatLng(t.y,t.x),e);else if(t.points){o=[];for(var s=0,n=t.points.length;n>s;s++)o.push(new L.Marker(new L.LatLng(t.points[s].y,t.points[s].x),e))}else if(t.paths)if(t.paths.length>1)for(o=[],s=0,n=t.paths.length;n>s;s++){for(var r=[],a=0,l=t.paths[s].length;l>a;a++)r.push(new L.LatLng(t.paths[s][a][1],t.paths[s][a][0]));o.push(new L.Polyline(r,e))}else{for(r=[],s=0,n=t.paths[0].length;n>s;s++)r.push(new L.LatLng(t.paths[0][s][1],t.paths[0][s][0]));i=new L.Polyline(r,e)}else if(t.rings)if(t.rings.length>1)for(o=[],s=0,n=t.rings.length;n>s;s++){for(var h=[],r=[],a=0,l=t.rings[s].length;l>a;a++)r.push(new L.LatLng(t.rings[s][a][1],t.rings[s][a][0]));h.push(r),o.push(new L.Polygon(h,e))}else{for(h=[],r=[],s=0,n=t.rings[0].length;n>s;s++)r.push(new L.LatLng(t.rings[0][s][1],t.rings[0][s][0]));h.push(r),i=new L.Polygon(h,e)}return i||o}}),lvector.AGS=lvector.EsriJSONLayer.extend({initialize:function(t){for(var e=0,i=this._requiredParams.length;i>e;e++)if(!t[this._requiredParams[e]])throw Error('No "'+this._requiredParams[e]+'" parameter found.');if(this._globalPointer="AGS_"+Math.floor(1e5*Math.random()),window[this._globalPointer]=this,"/"!==t.url.substr(t.url.length-1,1)&&(t.url+="/"),this._originalOptions=L.Util.extend({},t),t.esriOptions){if("object"!=typeof t.esriOptions)return void this._getEsriOptions();L.Util.extend(t,this._convertEsriOptions(t.esriOptions))}lvector.Layer.prototype.initialize.call(this,t),this.options.where&&(this.options.where=encodeURIComponent(this.options.where)),this._vectors=[],this.options.map&&(this.options.scaleRange&&this.options.scaleRange instanceof Array&&2===this.options.scaleRange.length&&(t=this.options.map.getZoom(),e=this.options.scaleRange,this.options.visibleAtScale=t>=e[0]&&t<=e[1]),this._show())},options:{where:"1=1",url:null,useEsriOptions:!1},_requiredParams:["url"],_convertEsriOptions:function(t){var e={};if(void 0!=t.minScale&&void 0!=t.maxScale){var i=this._scaleToLevel(t.minScale),o=this._scaleToLevel(t.maxScale);0==o&&(o=20),e.scaleRange=[i,o]}return t.drawingInfo&&t.drawingInfo.renderer&&(e.symbology=this._renderOptionsToSymbology(t.drawingInfo.renderer)),e},_getEsriOptions:function(){this._makeJsonpRequest(this._originalOptions.url+"?f=json&callback="+this._globalPointer+"._processEsriOptions")},_processEsriOptions:function(t){var e=this._originalOptions;e.esriOptions=t,this.initialize(e)},_scaleToLevel:function(t){var e=[591657527.591555,295828763.795777,147914381.897889,73957190.948944,36978595.474472,18489297.737236,9244648.868618,4622324.434309,2311162.217155,1155581.108577,577790.554289,288895.277144,144447.638572,72223.819286,36111.909643,18055.954822,9027.977411,4513.988705,2256.994353,1128.497176,564.248588,282.124294];if(0==t)return 0;for(var i=0,o=0;o<e.length-1;o++){var s=e[o+1];if(t<=e[o]&&t>s){i=o;break}}return i},_renderOptionsToSymbology:function(t){switch(symbology={},t.type){case"simple":symbology.type="single",symbology.vectorOptions=this._parseSymbology(t.symbol);break;case"uniqueValue":symbology.type="unique",symbology.property=t.field1;for(var e=[],i=0;i<t.uniqueValueInfos.length;i++){var o=t.uniqueValueInfos[i],s={};s.value=o.value,s.vectorOptions=this._parseSymbology(o.symbol),s.label=o.label,e.push(s)}symbology.values=e;break;case"classBreaks":for(symbology.type="range",symbology.property=rend.field,e=[],o=t.minValue,i=0;i<t.classBreakInfos.length;i++){var s=t.classBreakInfos[i],n={};n.range=[o,s.classMaxValue],o=s.classMaxValue,n.vectorOptions=this._parseSymbology(s.symbol),n.label=s.label,e.push(n)}symbology.ranges=e}return symbology},_parseSymbology:function(t){var e={};switch(t.type){case"esriSMS":case"esriPMS":t=L.icon({iconUrl:"data:"+t.contentType+";base64,"+t.imageData,shadowUrl:null,iconSize:new L.Point(t.width,t.height),iconAnchor:new L.Point(t.width/2+t.xoffset,t.height/2+t.yoffset),popupAnchor:new L.Point(0,-(t.height/2))}),e.icon=t;break;case"esriSLS":e.weight=t.width,e.color=this._parseColor(t.color),e.opacity=this._parseAlpha(t.color[3]);break;case"esriSFS":t.outline?(e.weight=t.outline.width,e.color=this._parseColor(t.outline.color),e.opacity=this._parseAlpha(t.outline.color[3])):(e.weight=0,e.color="#000000",e.opacity=0),"esriSFSNull"!=t.style?(e.fillColor=this._parseColor(t.color),e.fillOpacity=this._parseAlpha(t.color[3])):(e.fillColor="#000000",e.fillOpacity=0)}return e},_parseColor:function(t){return red=this._normalize(t[0]),green=this._normalize(t[1]),blue=this._normalize(t[2]),"#"+this._pad(red.toString(16))+this._pad(green.toString(16))+this._pad(blue.toString(16))},_normalize:function(t){return 1>t&&t>0?Math.floor(255*t):t},_pad:function(t){return t.length>1?t.toUpperCase():"0"+t.toUpperCase()},_parseAlpha:function(t){return t/255},_getFeatures:function(){var t=this.options.url+"query?returnGeometry=true&outSR=4326&f=json&outFields="+this.options.fields+"&where="+this.options.where+"&callback="+this._globalPointer+"._processFeatures";this.options.showAll||(t+="&inSR=4326&spatialRel=esriSpatialRelIntersects&geometryType=esriGeometryEnvelope&geometry="+this.options.map.getBounds().toBBoxString()),this._makeJsonpRequest(t)}}),lvector.A2E=lvector.AGS.extend({initialize:function(t){for(var e=0,i=this._requiredParams.length;i>e;e++)if(!t[this._requiredParams[e]])throw Error('No "'+this._requiredParams[e]+'" parameter found.');if(this._globalPointer="A2E_"+Math.floor(1e5*Math.random()),window[this._globalPointer]=this,"/"!==t.url.substr(t.url.length-1,1)&&(t.url+="/"),this._originalOptions=L.Util.extend({},t),t.esriOptions){if("object"!=typeof t.esriOptions)return void this._getEsriOptions();L.Util.extend(t,this._convertEsriOptions(t.esriOptions))}if(lvector.Layer.prototype.initialize.call(this,t),this.options.where&&(this.options.where=encodeURIComponent(this.options.where)),this._vectors=[],this.options.map&&(this.options.scaleRange&&this.options.scaleRange instanceof Array&&2===this.options.scaleRange.length&&(t=this.options.map.getZoom(),e=this.options.scaleRange,this.options.visibleAtScale=t>=e[0]&&t<=e[1]),this._show()),this.options.autoUpdate&&this.options.esriOptions.editFeedInfo){this._makeJsonpRequest("http://cdn.pubnub.com/pubnub-3.1.min.js");var o=this;this._pubNubScriptLoaderInterval=setInterval(function(){window.PUBNUB&&o._pubNubScriptLoaded()},200)}},_pubNubScriptLoaded:function(){clearInterval(this._pubNubScriptLoaderInterval),this.pubNub=PUBNUB.init({subscribe_key:this.options.esriOptions.editFeedInfo.pubnubSubscribeKey,ssl:!1,origin:"pubsub.pubnub.com"});var t=this;this.pubNub.subscribe({channel:this.options.esriOptions.editFeedInfo.pubnubChannel,callback:function(){t._getFeatures()},error:function(){}})}}),lvector.GeoIQ=lvector.GeoJSONLayer.extend({initialize:function(t){for(var e=0,i=this._requiredParams.length;i>e;e++)if(!t[this._requiredParams[e]])throw Error('No "'+this._requiredParams[e]+'" parameter found.');lvector.Layer.prototype.initialize.call(this,t),this._globalPointer="GeoIQ_"+Math.floor(1e5*Math.random()),window[this._globalPointer]=this,this._vectors=[],this.options.map&&(this.options.scaleRange&&this.options.scaleRange instanceof Array&&2===this.options.scaleRange.length&&(t=this.options.map.getZoom(),e=this.options.scaleRange,this.options.visibleAtScale=t>=e[0]&&t<=e[1]),this._show())},options:{dataset:null},_requiredParams:["dataset"],_getFeatures:function(){var t="http://geocommons.com/datasets/"+this.options.dataset+"/features.json?geojson=1&callback="+this._globalPointer+"._processFeatures&limit=999";this.options.showAll||(t+="&bbox="+this.options.map.getBounds().toBBoxString()+"&intersect=full"),
this._makeJsonpRequest(t)}}),lvector.CartoDB=lvector.GeoJSONLayer.extend({initialize:function(t){for(var e=0,i=this._requiredParams.length;i>e;e++)if(!t[this._requiredParams[e]])throw Error('No "'+this._requiredParams[e]+'" parameter found.');lvector.Layer.prototype.initialize.call(this,t),this._globalPointer="CartoDB_"+Math.floor(1e5*Math.random()),window[this._globalPointer]=this,this._vectors=[],this.options.map&&(this.options.scaleRange&&this.options.scaleRange instanceof Array&&2===this.options.scaleRange.length&&(t=this.options.map.getZoom(),e=this.options.scaleRange,this.options.visibleAtScale=t>=e[0]&&t<=e[1]),this._show())},options:{version:1,user:null,table:null,fields:"*",where:null,limit:null,uniqueField:"cartodb_id"},_requiredParams:["user","table"],_getFeatures:function(){var t=this.options.where||"";if(!this.options.showAll)for(var e=this.options.map.getBounds(),i=e.getSouthWest(),e=e.getNorthEast(),o=this.options.table.split(",").length,s=0;o>s;s++)t+=(t.length?" AND ":"")+(o>1?this.options.table.split(",")[s].split(".")[0]+".the_geom":"the_geom")+" && st_setsrid(st_makebox2d(st_point("+i.lng+","+i.lat+"),st_point("+e.lng+","+e.lat+")),4326)";this.options.limit&&(t+=(t.length?" ":"")+"limit "+this.options.limit),t=t.length?" "+t:"",this._makeJsonpRequest("http://"+this.options.user+".cartodb.com/api/v"+this.options.version+"/sql?q="+encodeURIComponent("SELECT "+this.options.fields+" FROM "+this.options.table+(t.length?" WHERE "+t:""))+"&format=geojson&callback="+this._globalPointer+"._processFeatures")}}),lvector.PRWSF=lvector.GeoJSONLayer.extend({initialize:function(t){for(var e=0,i=this._requiredParams.length;i>e;e++)if(!t[this._requiredParams[e]])throw Error('No "'+this._requiredParams[e]+'" parameter found.');"/"!==t.url.substr(t.url.length-1,1)&&(t.url+="/"),lvector.Layer.prototype.initialize.call(this,t),this._globalPointer="PRWSF_"+Math.floor(1e5*Math.random()),window[this._globalPointer]=this,this._vectors=[],this.options.map&&(this.options.scaleRange&&this.options.scaleRange instanceof Array&&2===this.options.scaleRange.length&&(t=this.options.map.getZoom(),e=this.options.scaleRange,this.options.visibleAtScale=t>=e[0]&&t<=e[1]),this._show())},options:{geotable:null,srid:null,geomFieldName:"the_geom",geomPrecision:"",fields:"",where:null,limit:null,uniqueField:null},_requiredParams:["url","geotable"],_getFeatures:function(){var t=this.options.where||"";if(!this.options.showAll){var e=this.options.map.getBounds(),i=e.getSouthWest(),e=e.getNorthEast();t+=t.length?" AND ":"",t+=this.options.srid?this.options.geomFieldName+" && transform(st_setsrid(st_makebox2d(st_point("+i.lng+","+i.lat+"),st_point("+e.lng+","+e.lat+")),4326),"+this.options.srid+")":"transform("+this.options.geomFieldName+",4326) && st_setsrid(st_makebox2d(st_point("+i.lng+","+i.lat+"),st_point("+e.lng+","+e.lat+")),4326)"}this.options.limit&&(t+=(t.length?" ":"")+"limit "+this.options.limit),i=(this.options.fields.length?this.options.fields+",":"")+"st_asgeojson(transform("+this.options.geomFieldName+",4326)"+(this.options.geomPrecision?","+this.options.geomPrecision:"")+") as geojson",this._makeJsonpRequest(this.options.url+"v1/ws_geo_attributequery.php?parameters="+encodeURIComponent(t)+"&geotable="+this.options.geotable+"&fields="+encodeURIComponent(i)+"&format=json&callback="+this._globalPointer+"._processFeatures")}}),lvector.GISCloud=lvector.GeoJSONLayer.extend({initialize:function(t){for(var e=0,i=this._requiredParams.length;i>e;e++)if(!t[this._requiredParams[e]])throw Error('No "'+this._requiredParams[e]+'" parameter found.');lvector.Layer.prototype.initialize.call(this,t),this._globalPointer="GISCloud_"+Math.floor(1e5*Math.random()),window[this._globalPointer]=this,this._vectors=[],this.options.map&&(this.options.scaleRange&&this.options.scaleRange instanceof Array&&2===this.options.scaleRange.length&&(t=this.options.map.getZoom(),e=this.options.scaleRange,this.options.visibleAtScale=t>=e[0]&&t<=e[1]),this._show())},options:{mapID:null,layerID:null,uniqueField:"id"},_requiredParams:["mapID","layerID"],_getFeatures:function(){var t="http://api.giscloud.com/1/maps/"+this.options.mapID+"/layers/"+this.options.layerID+"/features.json?geometry=geojson&epsg=4326&callback="+this._globalPointer+"._processFeatures";this.options.showAll||(t+="&bounds="+this.options.map.getBounds().toBBoxString()),this.options.where&&(t+="&where="+encodeURIComponent(this.options.where)),this._makeJsonpRequest(t)}}),lvector.GitSpatial=lvector.GeoJSONLayer.extend({initialize:function(t){for(var e=0,i=this._requiredParams.length;i>e;e++)if(!t[this._requiredParams[e]])throw Error('No "'+this._requiredParams[e]+'" parameter found.');lvector.Layer.prototype.initialize.call(this,t),this._globalPointer="GitSpatial_"+Math.floor(1e5*Math.random()),window[this._globalPointer]=this,this._vectors=[],this.options.map&&(this.options.scaleRange&&this.options.scaleRange instanceof Array&&2===this.options.scaleRange.length&&(t=this.options.map.getZoom(),e=this.options.scaleRange,this.options.visibleAtScale=t>=e[0]&&t<=e[1]),this._show())},options:{},_requiredParams:["user","repo","featureSet"],_getFeatures:function(){var t="http://gitspatial.com/api/v1/"+this.options.user+"/"+this.options.repo+"/"+this.options.featureSet+"?callback="+this._globalPointer+"._processFeatures";this.options.showAll||(t+="&bbox="+this.options.map.getBounds().toBBoxString()),this._makeJsonpRequest(t)}}),function(t){"use strict";function e(e){var i=t("");try{i=t(e).clone()}catch(o){i=t("<span />").html(e)}return i}function i(t){return!!("object"==typeof Node?t instanceof Node:t&&"object"==typeof t&&"number"==typeof t.nodeType&&"string"==typeof t.nodeName)}t.print=t.fn.print=function(){var o,s,n=this;n instanceof t&&(n=n.get(0)),i(n)?(s=t(n),arguments.length>0&&(o=arguments[0])):arguments.length>0?(s=t(arguments[0]),i(s[0])?arguments.length>1&&(o=arguments[1]):(o=arguments[0],s=t("html"))):s=t("html");var r={globalStyles:!0,mediaPrint:!1,stylesheet:null,noPrintSelector:".no-print",iframe:!0,append:null,prepend:null};o=t.extend({},r,o||{});var a=t("");o.globalStyles?a=t("style, link, meta, title"):o.mediaPrint&&(a=t("link[media=print]")),o.stylesheet&&(a=t.merge(a,t('<link rel="stylesheet" href="'+o.stylesheet+'">')));var l=s.clone();l=t("<span/>").append(l),l.find(o.noPrintSelector).remove(),l.append(a.clone()),l.append(e(o.append)),l.prepend(e(o.prepend));var h=l.html();l.remove();var p,c;if(o.iframe)try{var d=t(o.iframe+""),u=d.length;0===u&&(d=t('<iframe height="0" width="0" border="0" wmode="Opaque"/>').prependTo("body").css({position:"absolute",top:-999,left:-999})),p=d.get(0),p=p.contentWindow||p.contentDocument||p,c=p.document||p.contentDocument||p,c.open(),c.write(h),c.close(),setTimeout(function(){p.focus();try{p.document.execCommand("print",!1,null)||p.print()}catch(t){p.print()}setTimeout(function(){0===u&&d.remove()},100)},250)}catch(_){console.error("Failed to print from iframe",_.stack,_.message),p=window.open(),p.document.write(h),p.document.close(),p.focus(),p.print(),p.close()}else p=window.open(),p.document.write(h),p.document.close(),p.focus(),p.print(),p.close();return this}}(jQuery),!function(t,e){L.drawVersion="0.2.4-dev",L.drawLocal={draw:{toolbar:{actions:{title:"Cancel drawing",text:"Cancel"},undo:{title:"Delete last point drawn",text:"Delete last point"},buttons:{polyline:"Draw a polyline",polygon:"Draw a polygon",rectangle:"Draw a rectangle",circle:"Draw a circle",marker:"Draw a marker"}},handlers:{circle:{tooltip:{start:"Click and drag to draw circle."}},marker:{tooltip:{start:"Click map to place marker."}},polygon:{tooltip:{start:"Click to start drawing shape.",cont:"Click to continue drawing shape.",end:"Click first point to close this shape."}},polyline:{error:"<strong>Error:</strong> shape edges cannot cross!",tooltip:{start:"Click to start drawing line.",cont:"Click to continue drawing line.",end:"Click last point to finish line."}},rectangle:{tooltip:{start:"Click and drag to draw rectangle."}},simpleshape:{tooltip:{end:"Release mouse to finish drawing."}}}},edit:{toolbar:{actions:{save:{title:"Save changes.",text:"Save"},cancel:{title:"Cancel editing, discards all changes.",text:"Cancel"}},buttons:{edit:"Edit layers.",editDisabled:"No layers to edit.",remove:"Delete layers.",removeDisabled:"No layers to delete."}},handlers:{edit:{tooltip:{text:"Drag handles, or marker to edit feature.",subtext:"Click cancel to undo changes."}},remove:{tooltip:{text:"Click on a feature to remove"}}}}},L.Draw={},L.Draw.Feature=L.Handler.extend({includes:L.Mixin.Events,initialize:function(t,e){this._map=t,this._container=t._container,this._overlayPane=t._panes.overlayPane,this._popupPane=t._panes.popupPane,e&&e.shapeOptions&&(e.shapeOptions=L.Util.extend({},this.options.shapeOptions,e.shapeOptions)),L.setOptions(this,e)},enable:function(){this._enabled||(L.Handler.prototype.enable.call(this),this.fire("enabled",{handler:this.type}),this._map.fire("draw:drawstart",{layerType:this.type}))},disable:function(){this._enabled&&(L.Handler.prototype.disable.call(this),this._map.fire("draw:drawstop",{layerType:this.type}),this.fire("disabled",{handler:this.type}))},addHooks:function(){var t=this._map;t&&(L.DomUtil.disableTextSelection(),t.getContainer().focus(),this._tooltip=new L.Tooltip(this._map),L.DomEvent.on(this._container,"keyup",this._cancelDrawing,this))},removeHooks:function(){this._map&&(L.DomUtil.enableTextSelection(),this._tooltip.dispose(),this._tooltip=null,L.DomEvent.off(this._container,"keyup",this._cancelDrawing,this))},setOptions:function(t){L.setOptions(this,t)},_fireCreatedEvent:function(t){this._map.fire("draw:created",{layer:t,layerType:this.type})},_cancelDrawing:function(t){27===t.keyCode&&this.disable()}}),L.Draw.Polyline=L.Draw.Feature.extend({statics:{TYPE:"polyline"},Poly:L.Polyline,options:{allowIntersection:!0,repeatMode:!1,drawError:{color:"#b00b00",timeout:2500},icon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon"}),guidelineDistance:20,maxGuideLineLength:4e3,shapeOptions:{stroke:!0,color:"#f06eaa",weight:4,opacity:.5,fill:!1,clickable:!0},metric:!0,showLength:!0,zIndexOffset:2e3},initialize:function(t,e){this.options.drawError.message=L.drawLocal.draw.handlers.polyline.error,e&&e.drawError&&(e.drawError=L.Util.extend({},this.options.drawError,e.drawError)),this.type=L.Draw.Polyline.TYPE,L.Draw.Feature.prototype.initialize.call(this,t,e)},addHooks:function(){L.Draw.Feature.prototype.addHooks.call(this),this._map&&(this._markers=[],this._markerGroup=new L.LayerGroup,this._map.addLayer(this._markerGroup),this._poly=new L.Polyline([],this.options.shapeOptions),this._tooltip.updateContent(this._getTooltipText()),this._mouseMarker||(this._mouseMarker=L.marker(this._map.getCenter(),{icon:L.divIcon({className:"leaflet-mouse-marker",iconAnchor:[20,20],iconSize:[40,40]}),opacity:0,zIndexOffset:this.options.zIndexOffset})),this._mouseMarker.on("mousedown",this._onMouseDown,this).addTo(this._map),this._map.on("mousemove",this._onMouseMove,this).on("mouseup",this._onMouseUp,this).on("zoomend",this._onZoomEnd,this))},removeHooks:function(){L.Draw.Feature.prototype.removeHooks.call(this),this._clearHideErrorTimeout(),this._cleanUpShape(),this._map.removeLayer(this._markerGroup),delete this._markerGroup,delete this._markers,this._map.removeLayer(this._poly),delete this._poly,this._mouseMarker.off("mousedown",this._onMouseDown,this).off("mouseup",this._onMouseUp,this),this._map.removeLayer(this._mouseMarker),delete this._mouseMarker,this._clearGuides(),this._map.off("mousemove",this._onMouseMove,this).off("zoomend",this._onZoomEnd,this)},deleteLastVertex:function(){if(!(this._markers.length<=1)){var t=this._markers.pop(),e=this._poly,i=this._poly.spliceLatLngs(e.getLatLngs().length-1,1)[0];this._markerGroup.removeLayer(t),e.getLatLngs().length<2&&this._map.removeLayer(e),this._vertexChanged(i,!1)}},addVertex:function(t){var e=this._markers.length;return e>0&&!this.options.allowIntersection&&this._poly.newLatLngIntersects(t)?void this._showErrorTooltip():(this._errorShown&&this._hideErrorTooltip(),this._markers.push(this._createMarker(t)),this._poly.addLatLng(t),2===this._poly.getLatLngs().length&&this._map.addLayer(this._poly),void this._vertexChanged(t,!0))},_finishShape:function(){var t=this._poly.newLatLngIntersects(this._poly.getLatLngs()[0],!0);return!this.options.allowIntersection&&t||!this._shapeIsValid()?void this._showErrorTooltip():(this._fireCreatedEvent(),this.disable(),void(this.options.repeatMode&&this.enable()))},_shapeIsValid:function(){return!0},_onZoomEnd:function(){this._updateGuide()},_onMouseMove:function(t){var e=t.layerPoint,i=t.latlng;this._currentLatLng=i,this._updateTooltip(i),this._updateGuide(e),this._mouseMarker.setLatLng(i),L.DomEvent.preventDefault(t.originalEvent)},_vertexChanged:function(t,e){this._updateFinishHandler(),this._updateRunningMeasure(t,e),this._clearGuides(),this._updateTooltip()},_onMouseDown:function(t){var e=t.originalEvent;this._mouseDownOrigin=L.point(e.clientX,e.clientY)},_onMouseUp:function(e){if(this._mouseDownOrigin){var i=L.point(e.originalEvent.clientX,e.originalEvent.clientY).distanceTo(this._mouseDownOrigin);Math.abs(i)<9*(t.devicePixelRatio||1)&&this.addVertex(e.latlng)}this._mouseDownOrigin=null},_updateFinishHandler:function(){var t=this._markers.length;t>1&&this._markers[t-1].on("click",this._finishShape,this),t>2&&this._markers[t-2].off("click",this._finishShape,this)},_createMarker:function(t){var e=new L.Marker(t,{icon:this.options.icon,zIndexOffset:2*this.options.zIndexOffset});return this._markerGroup.addLayer(e),e},_updateGuide:function(t){var e=this._markers.length;e>0&&(t=t||this._map.latLngToLayerPoint(this._currentLatLng),this._clearGuides(),this._drawGuide(this._map.latLngToLayerPoint(this._markers[e-1].getLatLng()),t))},_updateTooltip:function(t){var e=this._getTooltipText();t&&this._tooltip.updatePosition(t),this._errorShown||this._tooltip.updateContent(e)},_drawGuide:function(t,e){var i,o,s,n=Math.floor(Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))),r=this.options.guidelineDistance,a=this.options.maxGuideLineLength,l=n>a?n-a:r;for(this._guidesContainer||(this._guidesContainer=L.DomUtil.create("div","leaflet-draw-guides",this._overlayPane));n>l;l+=this.options.guidelineDistance)i=l/n,o={x:Math.floor(t.x*(1-i)+i*e.x),y:Math.floor(t.y*(1-i)+i*e.y)},s=L.DomUtil.create("div","leaflet-draw-guide-dash",this._guidesContainer),s.style.backgroundColor=this._errorShown?this.options.drawError.color:this.options.shapeOptions.color,L.DomUtil.setPosition(s,o)},_updateGuideColor:function(t){if(this._guidesContainer)for(var e=0,i=this._guidesContainer.childNodes.length;i>e;e++)this._guidesContainer.childNodes[e].style.backgroundColor=t},_clearGuides:function(){if(this._guidesContainer)for(;this._guidesContainer.firstChild;)this._guidesContainer.removeChild(this._guidesContainer.firstChild)},_getTooltipText:function(){var t,e,i=this.options.showLength;return 0===this._markers.length?t={text:L.drawLocal.draw.handlers.polyline.tooltip.start}:(e=i?this._getMeasurementString():"",t=1===this._markers.length?{text:L.drawLocal.draw.handlers.polyline.tooltip.cont,subtext:e}:{text:L.drawLocal.draw.handlers.polyline.tooltip.end,subtext:e}),t},_updateRunningMeasure:function(t,e){var i,o,s=this._markers.length;1===this._markers.length?this._measurementRunningTotal=0:(i=s-(e?2:1),o=t.distanceTo(this._markers[i].getLatLng()),this._measurementRunningTotal+=o*(e?1:-1))},_getMeasurementString:function(){var t,e=this._currentLatLng,i=this._markers[this._markers.length-1].getLatLng();return t=this._measurementRunningTotal+e.distanceTo(i),L.GeometryUtil.readableDistance(t,this.options.metric)},_showErrorTooltip:function(){this._errorShown=!0,this._tooltip.showAsError().updateContent({text:this.options.drawError.message}),this._updateGuideColor(this.options.drawError.color),this._poly.setStyle({color:this.options.drawError.color}),this._clearHideErrorTimeout(),this._hideErrorTimeout=setTimeout(L.Util.bind(this._hideErrorTooltip,this),this.options.drawError.timeout)},_hideErrorTooltip:function(){this._errorShown=!1,this._clearHideErrorTimeout(),this._tooltip.removeError().updateContent(this._getTooltipText()),this._updateGuideColor(this.options.shapeOptions.color),this._poly.setStyle({color:this.options.shapeOptions.color})},_clearHideErrorTimeout:function(){this._hideErrorTimeout&&(clearTimeout(this._hideErrorTimeout),this._hideErrorTimeout=null)},_cleanUpShape:function(){this._markers.length>1&&this._markers[this._markers.length-1].off("click",this._finishShape,this)},_fireCreatedEvent:function(){var t=new this.Poly(this._poly.getLatLngs(),this.options.shapeOptions);L.Draw.Feature.prototype._fireCreatedEvent.call(this,t)}}),L.Draw.Polygon=L.Draw.Polyline.extend({statics:{TYPE:"polygon"},Poly:L.Polygon,options:{showArea:!1,shapeOptions:{stroke:!0,color:"#f06eaa",weight:4,opacity:.5,fill:!0,fillColor:null,fillOpacity:.2,clickable:!0}},initialize:function(t,e){L.Draw.Polyline.prototype.initialize.call(this,t,e),this.type=L.Draw.Polygon.TYPE},_updateFinishHandler:function(){var t=this._markers.length;1===t&&this._markers[0].on("click",this._finishShape,this),t>2&&(this._markers[t-1].on("dblclick",this._finishShape,this),t>3&&this._markers[t-2].off("dblclick",this._finishShape,this))},_getTooltipText:function(){var t,e;return 0===this._markers.length?t=L.drawLocal.draw.handlers.polygon.tooltip.start:this._markers.length<3?t=L.drawLocal.draw.handlers.polygon.tooltip.cont:(t=L.drawLocal.draw.handlers.polygon.tooltip.end,e=this._getMeasurementString()),{text:t,subtext:e}},_getMeasurementString:function(){var t=this._area;return t?L.GeometryUtil.readableArea(t,this.options.metric):null},_shapeIsValid:function(){return this._markers.length>=3},_vertexChanged:function(t,e){var i;!this.options.allowIntersection&&this.options.showArea&&(i=this._poly.getLatLngs(),this._area=L.GeometryUtil.geodesicArea(i)),L.Draw.Polyline.prototype._vertexChanged.call(this,t,e)},_cleanUpShape:function(){var t=this._markers.length;t>0&&(this._markers[0].off("click",this._finishShape,this),t>2&&this._markers[t-1].off("dblclick",this._finishShape,this))}}),L.SimpleShape={},L.Draw.SimpleShape=L.Draw.Feature.extend({options:{repeatMode:!1},initialize:function(t,e){this._endLabelText=L.drawLocal.draw.handlers.simpleshape.tooltip.end,L.Draw.Feature.prototype.initialize.call(this,t,e)},addHooks:function(){L.Draw.Feature.prototype.addHooks.call(this),this._map&&(this._mapDraggable=this._map.dragging.enabled(),this._mapDraggable&&this._map.dragging.disable(),this._container.style.cursor="crosshair",this._tooltip.updateContent({text:this._initialLabelText}),this._map.on("mousedown",this._onMouseDown,this).on("mousemove",this._onMouseMove,this))},removeHooks:function(){L.Draw.Feature.prototype.removeHooks.call(this),this._map&&(this._mapDraggable&&this._map.dragging.enable(),this._container.style.cursor="",this._map.off("mousedown",this._onMouseDown,this).off("mousemove",this._onMouseMove,this),L.DomEvent.off(e,"mouseup",this._onMouseUp,this),this._shape&&(this._map.removeLayer(this._shape),delete this._shape)),this._isDrawing=!1},_getTooltipText:function(){return{text:this._endLabelText}},_onMouseDown:function(t){this._isDrawing=!0,this._startLatLng=t.latlng,L.DomEvent.on(e,"mouseup",this._onMouseUp,this).preventDefault(t.originalEvent)},_onMouseMove:function(t){var e=t.latlng;this._tooltip.updatePosition(e),this._isDrawing&&(this._tooltip.updateContent(this._getTooltipText()),this._drawShape(e))},_onMouseUp:function(){this._shape&&this._fireCreatedEvent(),this.disable(),this.options.repeatMode&&this.enable()}}),L.Draw.Rectangle=L.Draw.SimpleShape.extend({statics:{TYPE:"rectangle"},options:{shapeOptions:{stroke:!0,color:"#f06eaa",weight:4,opacity:.5,fill:!0,fillColor:null,fillOpacity:.2,clickable:!0},metric:!0},initialize:function(t,e){this.type=L.Draw.Rectangle.TYPE,this._initialLabelText=L.drawLocal.draw.handlers.rectangle.tooltip.start,L.Draw.SimpleShape.prototype.initialize.call(this,t,e)},_drawShape:function(t){this._shape?this._shape.setBounds(new L.LatLngBounds(this._startLatLng,t)):(this._shape=new L.Rectangle(new L.LatLngBounds(this._startLatLng,t),this.options.shapeOptions),this._map.addLayer(this._shape))},_fireCreatedEvent:function(){var t=new L.Rectangle(this._shape.getBounds(),this.options.shapeOptions);L.Draw.SimpleShape.prototype._fireCreatedEvent.call(this,t)},_getTooltipText:function(){var t,e,i,o=L.Draw.SimpleShape.prototype._getTooltipText.call(this),s=this._shape;return s&&(t=this._shape.getLatLngs(),e=L.GeometryUtil.geodesicArea(t),i=L.GeometryUtil.readableArea(e,this.options.metric)),{text:o.text,subtext:i}}}),L.Draw.Circle=L.Draw.SimpleShape.extend({statics:{TYPE:"circle"},options:{shapeOptions:{stroke:!0,color:"#f06eaa",weight:4,opacity:.5,fill:!0,fillColor:null,fillOpacity:.2,clickable:!0},showRadius:!0,metric:!0},initialize:function(t,e){this.type=L.Draw.Circle.TYPE,this._initialLabelText=L.drawLocal.draw.handlers.circle.tooltip.start,L.Draw.SimpleShape.prototype.initialize.call(this,t,e)},_drawShape:function(t){this._shape?this._shape.setRadius(this._startLatLng.distanceTo(t)):(this._shape=new L.Circle(this._startLatLng,this._startLatLng.distanceTo(t),this.options.shapeOptions),this._map.addLayer(this._shape))},_fireCreatedEvent:function(){var t=new L.Circle(this._startLatLng,this._shape.getRadius(),this.options.shapeOptions);L.Draw.SimpleShape.prototype._fireCreatedEvent.call(this,t)},_onMouseMove:function(t){var e,i=t.latlng,o=this.options.showRadius,s=this.options.metric;this._tooltip.updatePosition(i),this._isDrawing&&(this._drawShape(i),e=this._shape.getRadius().toFixed(1),this._tooltip.updateContent({text:this._endLabelText,subtext:o?"Radius: "+L.GeometryUtil.readableDistance(e,s):""}))}}),L.Draw.Marker=L.Draw.Feature.extend({statics:{TYPE:"marker"},options:{icon:new L.Icon.Default,repeatMode:!1,zIndexOffset:2e3},initialize:function(t,e){this.type=L.Draw.Marker.TYPE,L.Draw.Feature.prototype.initialize.call(this,t,e)},addHooks:function(){L.Draw.Feature.prototype.addHooks.call(this),this._map&&(this._tooltip.updateContent({text:L.drawLocal.draw.handlers.marker.tooltip.start}),this._mouseMarker||(this._mouseMarker=L.marker(this._map.getCenter(),{icon:L.divIcon({className:"leaflet-mouse-marker",iconAnchor:[20,20],iconSize:[40,40]}),opacity:0,zIndexOffset:this.options.zIndexOffset})),this._mouseMarker.on("click",this._onClick,this).addTo(this._map),this._map.on("mousemove",this._onMouseMove,this))},removeHooks:function(){L.Draw.Feature.prototype.removeHooks.call(this),this._map&&(this._marker&&(this._marker.off("click",this._onClick,this),this._map.off("click",this._onClick,this).removeLayer(this._marker),delete this._marker),this._mouseMarker.off("click",this._onClick,this),this._map.removeLayer(this._mouseMarker),delete this._mouseMarker,this._map.off("mousemove",this._onMouseMove,this))},_onMouseMove:function(t){var e=t.latlng;this._tooltip.updatePosition(e),this._mouseMarker.setLatLng(e),this._marker?(e=this._mouseMarker.getLatLng(),this._marker.setLatLng(e)):(this._marker=new L.Marker(e,{icon:this.options.icon,zIndexOffset:this.options.zIndexOffset}),this._marker.on("click",this._onClick,this),this._map.on("click",this._onClick,this).addLayer(this._marker))},_onClick:function(){this._fireCreatedEvent(),this.disable(),this.options.repeatMode&&this.enable()},_fireCreatedEvent:function(){var t=new L.Marker(this._marker.getLatLng(),{icon:this.options.icon});L.Draw.Feature.prototype._fireCreatedEvent.call(this,t)}}),L.Edit=L.Edit||{},L.Edit.Poly=L.Handler.extend({options:{icon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon"})},initialize:function(t,e){this._poly=t,L.setOptions(this,e)},addHooks:function(){this._poly._map&&(this._markerGroup||this._initMarkers(),this._poly._map.addLayer(this._markerGroup))},removeHooks:function(){this._poly._map&&(this._poly._map.removeLayer(this._markerGroup),delete this._markerGroup,delete this._markers)},updateMarkers:function(){this._markerGroup.clearLayers(),this._initMarkers()},_initMarkers:function(){this._markerGroup||(this._markerGroup=new L.LayerGroup),this._markers=[];var t,e,i,o,s=this._poly._latlngs;for(t=0,i=s.length;i>t;t++)o=this._createMarker(s[t],t),o.on("click",this._onMarkerClick,this),this._markers.push(o);var n,r;for(t=0,e=i-1;i>t;e=t++)(0!==t||L.Polygon&&this._poly instanceof L.Polygon)&&(n=this._markers[e],r=this._markers[t],this._createMiddleMarker(n,r),this._updatePrevNext(n,r))},_createMarker:function(t,e){var i=new L.Marker(t,{draggable:!0,icon:this.options.icon});return i._origLatLng=t,i._index=e,i.on("drag",this._onMarkerDrag,this),i.on("dragend",this._fireEdit,this),this._markerGroup.addLayer(i),i},_removeMarker:function(t){var e=t._index;this._markerGroup.removeLayer(t),this._markers.splice(e,1),this._poly.spliceLatLngs(e,1),this._updateIndexes(e,-1),t.off("drag",this._onMarkerDrag,this).off("dragend",this._fireEdit,this).off("click",this._onMarkerClick,this)},_fireEdit:function(){this._poly.edited=!0,this._poly.fire("edit")},_onMarkerDrag:function(t){var e=t.target;L.extend(e._origLatLng,e._latlng),e._middleLeft&&e._middleLeft.setLatLng(this._getMiddleLatLng(e._prev,e)),e._middleRight&&e._middleRight.setLatLng(this._getMiddleLatLng(e,e._next)),this._poly.redraw()},_onMarkerClick:function(t){var e=L.Polygon&&this._poly instanceof L.Polygon?4:3,i=t.target;this._poly._latlngs.length<e||(this._removeMarker(i),this._updatePrevNext(i._prev,i._next),i._middleLeft&&this._markerGroup.removeLayer(i._middleLeft),i._middleRight&&this._markerGroup.removeLayer(i._middleRight),i._prev&&i._next?this._createMiddleMarker(i._prev,i._next):i._prev?i._next||(i._prev._middleRight=null):i._next._middleLeft=null,this._fireEdit())},_updateIndexes:function(t,e){this._markerGroup.eachLayer(function(i){i._index>t&&(i._index+=e)})},_createMiddleMarker:function(t,e){var i,o,s,n=this._getMiddleLatLng(t,e),r=this._createMarker(n);r.setOpacity(.6),t._middleRight=e._middleLeft=r,o=function(){var o=e._index;r._index=o,r.off("click",i,this).on("click",this._onMarkerClick,this),n.lat=r.getLatLng().lat,n.lng=r.getLatLng().lng,this._poly.spliceLatLngs(o,0,n),this._markers.splice(o,0,r),r.setOpacity(1),this._updateIndexes(o,1),e._index++,this._updatePrevNext(t,r),this._updatePrevNext(r,e),this._poly.fire("editstart")},s=function(){r.off("dragstart",o,this),r.off("dragend",s,this),this._createMiddleMarker(t,r),this._createMiddleMarker(r,e)},i=function(){o.call(this),s.call(this),this._fireEdit()},r.on("click",i,this).on("dragstart",o,this).on("dragend",s,this),this._markerGroup.addLayer(r)},_updatePrevNext:function(t,e){t&&(t._next=e),e&&(e._prev=t)},_getMiddleLatLng:function(t,e){var i=this._poly._map,o=i.project(t.getLatLng()),s=i.project(e.getLatLng());return i.unproject(o._add(s)._divideBy(2))}}),L.Polyline.addInitHook(function(){this.editing||(L.Edit.Poly&&(this.editing=new L.Edit.Poly(this),this.options.editable&&this.editing.enable()),this.on("add",function(){this.editing&&this.editing.enabled()&&this.editing.addHooks()}),this.on("remove",function(){this.editing&&this.editing.enabled()&&this.editing.removeHooks()}))}),L.Edit=L.Edit||{},L.Edit.SimpleShape=L.Handler.extend({options:{moveIcon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon leaflet-edit-move"}),resizeIcon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon leaflet-edit-resize"})},initialize:function(t,e){this._shape=t,L.Util.setOptions(this,e)},addHooks:function(){this._shape._map&&(this._map=this._shape._map,this._markerGroup||this._initMarkers(),this._map.addLayer(this._markerGroup))},removeHooks:function(){if(this._shape._map){this._unbindMarker(this._moveMarker);for(var t=0,e=this._resizeMarkers.length;e>t;t++)this._unbindMarker(this._resizeMarkers[t]);this._resizeMarkers=null,this._map.removeLayer(this._markerGroup),delete this._markerGroup}this._map=null},updateMarkers:function(){this._markerGroup.clearLayers(),this._initMarkers()},_initMarkers:function(){this._markerGroup||(this._markerGroup=new L.LayerGroup),this._createMoveMarker(),this._createResizeMarker()},_createMoveMarker:function(){},_createResizeMarker:function(){},_createMarker:function(t,e){var i=new L.Marker(t,{draggable:!0,icon:e,zIndexOffset:10});return this._bindMarker(i),this._markerGroup.addLayer(i),i},_bindMarker:function(t){t.on("dragstart",this._onMarkerDragStart,this).on("drag",this._onMarkerDrag,this).on("dragend",this._onMarkerDragEnd,this)},_unbindMarker:function(t){t.off("dragstart",this._onMarkerDragStart,this).off("drag",this._onMarkerDrag,this).off("dragend",this._onMarkerDragEnd,this)},_onMarkerDragStart:function(t){var e=t.target;e.setOpacity(0),this._shape.fire("editstart")},_fireEdit:function(){this._shape.edited=!0,this._shape.fire("edit")},_onMarkerDrag:function(t){var e=t.target,i=e.getLatLng();e===this._moveMarker?this._move(i):this._resize(i),this._shape.redraw()},_onMarkerDragEnd:function(t){var e=t.target;e.setOpacity(1),this._fireEdit()},_move:function(){},_resize:function(){}}),L.Edit=L.Edit||{},L.Edit.Rectangle=L.Edit.SimpleShape.extend({_createMoveMarker:function(){var t=this._shape.getBounds(),e=t.getCenter();this._moveMarker=this._createMarker(e,this.options.moveIcon)},_createResizeMarker:function(){var t=this._getCorners();this._resizeMarkers=[];for(var e=0,i=t.length;i>e;e++)this._resizeMarkers.push(this._createMarker(t[e],this.options.resizeIcon)),this._resizeMarkers[e]._cornerIndex=e},_onMarkerDragStart:function(t){L.Edit.SimpleShape.prototype._onMarkerDragStart.call(this,t);var e=this._getCorners(),i=t.target,o=i._cornerIndex;this._oppositeCorner=e[(o+2)%4],this._toggleCornerMarkers(0,o)},_onMarkerDragEnd:function(t){var e,i,o=t.target;o===this._moveMarker&&(e=this._shape.getBounds(),i=e.getCenter(),o.setLatLng(i)),this._toggleCornerMarkers(1),this._repositionCornerMarkers(),L.Edit.SimpleShape.prototype._onMarkerDragEnd.call(this,t)},_move:function(t){for(var e,i=this._shape.getLatLngs(),o=this._shape.getBounds(),s=o.getCenter(),n=[],r=0,a=i.length;a>r;r++)e=[i[r].lat-s.lat,i[r].lng-s.lng],n.push([t.lat+e[0],t.lng+e[1]]);this._shape.setLatLngs(n),this._repositionCornerMarkers()},_resize:function(t){var e;this._shape.setBounds(L.latLngBounds(t,this._oppositeCorner)),e=this._shape.getBounds(),this._moveMarker.setLatLng(e.getCenter())},_getCorners:function(){var t=this._shape.getBounds(),e=t.getNorthWest(),i=t.getNorthEast(),o=t.getSouthEast(),s=t.getSouthWest();return[e,i,o,s]},_toggleCornerMarkers:function(t){for(var e=0,i=this._resizeMarkers.length;i>e;e++)this._resizeMarkers[e].setOpacity(t)},_repositionCornerMarkers:function(){for(var t=this._getCorners(),e=0,i=this._resizeMarkers.length;i>e;e++)this._resizeMarkers[e].setLatLng(t[e])}}),L.Rectangle.addInitHook(function(){L.Edit.Rectangle&&(this.editing=new L.Edit.Rectangle(this),this.options.editable&&this.editing.enable())}),L.Edit=L.Edit||{},L.Edit.Circle=L.Edit.SimpleShape.extend({_createMoveMarker:function(){var t=this._shape.getLatLng();this._moveMarker=this._createMarker(t,this.options.moveIcon)},_createResizeMarker:function(){var t=this._shape.getLatLng(),e=this._getResizeMarkerPoint(t);this._resizeMarkers=[],this._resizeMarkers.push(this._createMarker(e,this.options.resizeIcon))},_getResizeMarkerPoint:function(t){var e=this._shape._radius*Math.cos(Math.PI/4),i=this._map.project(t);return this._map.unproject([i.x+e,i.y-e])},_move:function(t){var e=this._getResizeMarkerPoint(t);this._resizeMarkers[0].setLatLng(e),this._shape.setLatLng(t)},_resize:function(t){var e=this._moveMarker.getLatLng(),i=e.distanceTo(t);this._shape.setRadius(i)}}),L.Circle.addInitHook(function(){L.Edit.Circle&&(this.editing=new L.Edit.Circle(this),this.options.editable&&this.editing.enable()),this.on("add",function(){this.editing&&this.editing.enabled()&&this.editing.addHooks()}),this.on("remove",function(){
this.editing&&this.editing.enabled()&&this.editing.removeHooks()})}),L.LatLngUtil={cloneLatLngs:function(t){for(var e=[],i=0,o=t.length;o>i;i++)e.push(this.cloneLatLng(t[i]));return e},cloneLatLng:function(t){return L.latLng(t.lat,t.lng)}},L.GeometryUtil=L.extend(L.GeometryUtil||{},{geodesicArea:function(t){var e,i,o=t.length,s=0,n=L.LatLng.DEG_TO_RAD;if(o>2){for(var r=0;o>r;r++)e=t[r],i=t[(r+1)%o],s+=(i.lng-e.lng)*n*(2+Math.sin(e.lat*n)+Math.sin(i.lat*n));s=6378137*s*6378137/2}return Math.abs(s)},readableArea:function(t,e){var i;return e?i=t>=1e4?(1e-4*t).toFixed(2)+" ha":t.toFixed(2)+" m&sup2;":(t/=.836127,i=t>=3097600?(t/3097600).toFixed(2)+" mi&sup2;":t>=4840?(t/4840).toFixed(2)+" acres":Math.ceil(t)+" yd&sup2;"),i},readableDistance:function(t,e){var i;return e?i=t>1e3?(t/1e3).toFixed(2)+" km":Math.ceil(t)+" m":(t*=1.09361,i=t>1760?(t/1760).toFixed(2)+" miles":Math.ceil(t)+" yd"),i}}),L.Util.extend(L.LineUtil,{segmentsIntersect:function(t,e,i,o){return this._checkCounterclockwise(t,i,o)!==this._checkCounterclockwise(e,i,o)&&this._checkCounterclockwise(t,e,i)!==this._checkCounterclockwise(t,e,o)},_checkCounterclockwise:function(t,e,i){return(i.y-t.y)*(e.x-t.x)>(e.y-t.y)*(i.x-t.x)}}),L.Polyline.include({intersects:function(){var t,e,i,o=this._originalPoints,s=o?o.length:0;if(this._tooFewPointsForIntersection())return!1;for(t=s-1;t>=3;t--)if(e=o[t-1],i=o[t],this._lineSegmentsIntersectsRange(e,i,t-2))return!0;return!1},newLatLngIntersects:function(t,e){return this._map?this.newPointIntersects(this._map.latLngToLayerPoint(t),e):!1},newPointIntersects:function(t,e){var i=this._originalPoints,o=i?i.length:0,s=i?i[o-1]:null,n=o-2;return this._tooFewPointsForIntersection(1)?!1:this._lineSegmentsIntersectsRange(s,t,n,e?1:0)},_tooFewPointsForIntersection:function(t){var e=this._originalPoints,i=e?e.length:0;return i+=t||0,!this._originalPoints||3>=i},_lineSegmentsIntersectsRange:function(t,e,i,o){var s,n,r=this._originalPoints;o=o||0;for(var a=i;a>o;a--)if(s=r[a-1],n=r[a],L.LineUtil.segmentsIntersect(t,e,s,n))return!0;return!1}}),L.Polygon.include({intersects:function(){var t,e,i,o,s,n=this._originalPoints;return this._tooFewPointsForIntersection()?!1:(t=L.Polyline.prototype.intersects.call(this))?!0:(e=n.length,i=n[0],o=n[e-1],s=e-2,this._lineSegmentsIntersectsRange(o,i,s,1))}}),L.Control.Draw=L.Control.extend({options:{position:"topleft",draw:{},edit:!1},initialize:function(t){if(L.version<"0.7")throw new Error("Leaflet.draw 0.2.3+ requires Leaflet 0.7.0+. Download latest from https://github.com/Leaflet/Leaflet/");L.Control.prototype.initialize.call(this,t);var e;this._toolbars={},L.DrawToolbar&&this.options.draw&&(e=new L.DrawToolbar(this.options.draw),this._toolbars[L.DrawToolbar.TYPE]=e,this._toolbars[L.DrawToolbar.TYPE].on("enable",this._toolbarEnabled,this)),L.EditToolbar&&this.options.edit&&(e=new L.EditToolbar(this.options.edit),this._toolbars[L.EditToolbar.TYPE]=e,this._toolbars[L.EditToolbar.TYPE].on("enable",this._toolbarEnabled,this))},onAdd:function(t){var e,i=L.DomUtil.create("div","leaflet-draw"),o=!1,s="leaflet-draw-toolbar-top";for(var n in this._toolbars)this._toolbars.hasOwnProperty(n)&&(e=this._toolbars[n].addToolbar(t),e&&(o||(L.DomUtil.hasClass(e,s)||L.DomUtil.addClass(e.childNodes[0],s),o=!0),i.appendChild(e)));return i},onRemove:function(){for(var t in this._toolbars)this._toolbars.hasOwnProperty(t)&&this._toolbars[t].removeToolbar()},setDrawingOptions:function(t){for(var e in this._toolbars)this._toolbars[e]instanceof L.DrawToolbar&&this._toolbars[e].setOptions(t)},_toolbarEnabled:function(t){var e=t.target;for(var i in this._toolbars)this._toolbars[i]!==e&&this._toolbars[i].disable()}}),L.Map.mergeOptions({drawControlTooltips:!0,drawControl:!1}),L.Map.addInitHook(function(){this.options.drawControl&&(this.drawControl=new L.Control.Draw,this.addControl(this.drawControl))}),L.Toolbar=L.Class.extend({includes:[L.Mixin.Events],initialize:function(t){L.setOptions(this,t),this._modes={},this._actionButtons=[],this._activeMode=null},enabled:function(){return null!==this._activeMode},disable:function(){this.enabled()&&this._activeMode.handler.disable()},addToolbar:function(t){var e,i=L.DomUtil.create("div","leaflet-draw-section"),o=0,s=this._toolbarClass||"",n=this.getModeHandlers(t);for(this._toolbarContainer=L.DomUtil.create("div","leaflet-draw-toolbar leaflet-bar"),this._map=t,e=0;e<n.length;e++)n[e].enabled&&this._initModeHandler(n[e].handler,this._toolbarContainer,o++,s,n[e].title);return o?(this._lastButtonIndex=--o,this._actionsContainer=L.DomUtil.create("ul","leaflet-draw-actions"),i.appendChild(this._toolbarContainer),i.appendChild(this._actionsContainer),i):void 0},removeToolbar:function(){for(var t in this._modes)this._modes.hasOwnProperty(t)&&(this._disposeButton(this._modes[t].button,this._modes[t].handler.enable,this._modes[t].handler),this._modes[t].handler.disable(),this._modes[t].handler.off("enabled",this._handlerActivated,this).off("disabled",this._handlerDeactivated,this));this._modes={};for(var e=0,i=this._actionButtons.length;i>e;e++)this._disposeButton(this._actionButtons[e].button,this._actionButtons[e].callback,this);this._actionButtons=[],this._actionsContainer=null},_initModeHandler:function(t,e,i,o,s){var n=t.type;this._modes[n]={},this._modes[n].handler=t,this._modes[n].button=this._createButton({title:s,className:o+"-"+n,container:e,callback:this._modes[n].handler.enable,context:this._modes[n].handler}),this._modes[n].buttonIndex=i,this._modes[n].handler.on("enabled",this._handlerActivated,this).on("disabled",this._handlerDeactivated,this)},_createButton:function(t){var e=L.DomUtil.create("a",t.className||"",t.container);return e.href="#",t.text&&(e.innerHTML=t.text),t.title&&(e.title=t.title),L.DomEvent.on(e,"click",L.DomEvent.stopPropagation).on(e,"mousedown",L.DomEvent.stopPropagation).on(e,"dblclick",L.DomEvent.stopPropagation).on(e,"click",L.DomEvent.preventDefault).on(e,"click",t.callback,t.context),e},_disposeButton:function(t,e){L.DomEvent.off(t,"click",L.DomEvent.stopPropagation).off(t,"mousedown",L.DomEvent.stopPropagation).off(t,"dblclick",L.DomEvent.stopPropagation).off(t,"click",L.DomEvent.preventDefault).off(t,"click",e)},_handlerActivated:function(t){this.disable(),this._activeMode=this._modes[t.handler],L.DomUtil.addClass(this._activeMode.button,"leaflet-draw-toolbar-button-enabled"),this._showActionsToolbar(),this.fire("enable")},_handlerDeactivated:function(){this._hideActionsToolbar(),L.DomUtil.removeClass(this._activeMode.button,"leaflet-draw-toolbar-button-enabled"),this._activeMode=null,this.fire("disable")},_createActions:function(t){var e,i,o,s,n=this._actionsContainer,r=this.getActions(t),a=r.length;for(i=0,o=this._actionButtons.length;o>i;i++)this._disposeButton(this._actionButtons[i].button,this._actionButtons[i].callback);for(this._actionButtons=[];n.firstChild;)n.removeChild(n.firstChild);for(var l=0;a>l;l++)"enabled"in r[l]&&!r[l].enabled||(e=L.DomUtil.create("li","",n),s=this._createButton({title:r[l].title,text:r[l].text,container:e,callback:r[l].callback,context:r[l].context}),this._actionButtons.push({button:s,callback:r[l].callback}))},_showActionsToolbar:function(){var t=this._activeMode.buttonIndex,e=this._lastButtonIndex,i=this._activeMode.button.offsetTop-1;this._createActions(this._activeMode.handler),this._actionsContainer.style.top=i+"px",0===t&&(L.DomUtil.addClass(this._toolbarContainer,"leaflet-draw-toolbar-notop"),L.DomUtil.addClass(this._actionsContainer,"leaflet-draw-actions-top")),t===e&&(L.DomUtil.addClass(this._toolbarContainer,"leaflet-draw-toolbar-nobottom"),L.DomUtil.addClass(this._actionsContainer,"leaflet-draw-actions-bottom")),this._actionsContainer.style.display="block"},_hideActionsToolbar:function(){this._actionsContainer.style.display="none",L.DomUtil.removeClass(this._toolbarContainer,"leaflet-draw-toolbar-notop"),L.DomUtil.removeClass(this._toolbarContainer,"leaflet-draw-toolbar-nobottom"),L.DomUtil.removeClass(this._actionsContainer,"leaflet-draw-actions-top"),L.DomUtil.removeClass(this._actionsContainer,"leaflet-draw-actions-bottom")}}),L.Tooltip=L.Class.extend({initialize:function(t){this._map=t,this._popupPane=t._panes.popupPane,this._container=t.options.drawControlTooltips?L.DomUtil.create("div","leaflet-draw-tooltip",this._popupPane):null,this._singleLineLabel=!1},dispose:function(){this._container&&(this._popupPane.removeChild(this._container),this._container=null)},updateContent:function(t){return this._container?(t.subtext=t.subtext||"",0!==t.subtext.length||this._singleLineLabel?t.subtext.length>0&&this._singleLineLabel&&(L.DomUtil.removeClass(this._container,"leaflet-draw-tooltip-single"),this._singleLineLabel=!1):(L.DomUtil.addClass(this._container,"leaflet-draw-tooltip-single"),this._singleLineLabel=!0),this._container.innerHTML=(t.subtext.length>0?'<span class="leaflet-draw-tooltip-subtext">'+t.subtext+"</span><br />":"")+"<span>"+t.text+"</span>",this):this},updatePosition:function(t){var e=this._map.latLngToLayerPoint(t),i=this._container;return this._container&&(i.style.visibility="inherit",L.DomUtil.setPosition(i,e)),this},showAsError:function(){return this._container&&L.DomUtil.addClass(this._container,"leaflet-error-draw-tooltip"),this},removeError:function(){return this._container&&L.DomUtil.removeClass(this._container,"leaflet-error-draw-tooltip"),this}}),L.DrawToolbar=L.Toolbar.extend({statics:{TYPE:"draw"},options:{polyline:{},polygon:{},rectangle:{},circle:{},marker:{}},initialize:function(t){for(var e in this.options)this.options.hasOwnProperty(e)&&t[e]&&(t[e]=L.extend({},this.options[e],t[e]));this._toolbarClass="leaflet-draw-draw",L.Toolbar.prototype.initialize.call(this,t)},getModeHandlers:function(t){return[{enabled:this.options.polyline,handler:new L.Draw.Polyline(t,this.options.polyline),title:L.drawLocal.draw.toolbar.buttons.polyline},{enabled:this.options.polygon,handler:new L.Draw.Polygon(t,this.options.polygon),title:L.drawLocal.draw.toolbar.buttons.polygon},{enabled:this.options.rectangle,handler:new L.Draw.Rectangle(t,this.options.rectangle),title:L.drawLocal.draw.toolbar.buttons.rectangle},{enabled:this.options.circle,handler:new L.Draw.Circle(t,this.options.circle),title:L.drawLocal.draw.toolbar.buttons.circle},{enabled:this.options.marker,handler:new L.Draw.Marker(t,this.options.marker),title:L.drawLocal.draw.toolbar.buttons.marker}]},getActions:function(t){return[{enabled:t.deleteLastVertex,title:L.drawLocal.draw.toolbar.undo.title,text:L.drawLocal.draw.toolbar.undo.text,callback:t.deleteLastVertex,context:t},{title:L.drawLocal.draw.toolbar.actions.title,text:L.drawLocal.draw.toolbar.actions.text,callback:this.disable,context:this}]},setOptions:function(t){L.setOptions(this,t);for(var e in this._modes)this._modes.hasOwnProperty(e)&&t.hasOwnProperty(e)&&this._modes[e].handler.setOptions(t[e])}}),L.EditToolbar=L.Toolbar.extend({statics:{TYPE:"edit"},options:{edit:{selectedPathOptions:{color:"#fe57a1",opacity:.6,dashArray:"10, 10",fill:!0,fillColor:"#fe57a1",fillOpacity:.1,maintainColor:!1}},remove:{},featureGroup:null},initialize:function(t){t.edit&&("undefined"==typeof t.edit.selectedPathOptions&&(t.edit.selectedPathOptions=this.options.edit.selectedPathOptions),t.edit.selectedPathOptions=L.extend({},this.options.edit.selectedPathOptions,t.edit.selectedPathOptions)),t.remove&&(t.remove=L.extend({},this.options.remove,t.remove)),this._toolbarClass="leaflet-draw-edit",L.Toolbar.prototype.initialize.call(this,t),this._selectedFeatureCount=0},getModeHandlers:function(t){var e=this.options.featureGroup;return[{enabled:this.options.edit,handler:new L.EditToolbar.Edit(t,{featureGroup:e,selectedPathOptions:this.options.edit.selectedPathOptions}),title:L.drawLocal.edit.toolbar.buttons.edit},{enabled:this.options.remove,handler:new L.EditToolbar.Delete(t,{featureGroup:e}),title:L.drawLocal.edit.toolbar.buttons.remove}]},getActions:function(){return[{title:L.drawLocal.edit.toolbar.actions.save.title,text:L.drawLocal.edit.toolbar.actions.save.text,callback:this._save,context:this},{title:L.drawLocal.edit.toolbar.actions.cancel.title,text:L.drawLocal.edit.toolbar.actions.cancel.text,callback:this.disable,context:this}]},addToolbar:function(t){var e=L.Toolbar.prototype.addToolbar.call(this,t);return this._checkDisabled(),this.options.featureGroup.on("layeradd layerremove",this._checkDisabled,this),e},removeToolbar:function(){this.options.featureGroup.off("layeradd layerremove",this._checkDisabled,this),L.Toolbar.prototype.removeToolbar.call(this)},disable:function(){this.enabled()&&(this._activeMode.handler.revertLayers(),L.Toolbar.prototype.disable.call(this))},_save:function(){this._activeMode.handler.save(),this._activeMode.handler.disable()},_checkDisabled:function(){var t,e=this.options.featureGroup,i=0!==e.getLayers().length;this.options.edit&&(t=this._modes[L.EditToolbar.Edit.TYPE].button,i?L.DomUtil.removeClass(t,"leaflet-disabled"):L.DomUtil.addClass(t,"leaflet-disabled"),t.setAttribute("title",i?L.drawLocal.edit.toolbar.buttons.edit:L.drawLocal.edit.toolbar.buttons.editDisabled)),this.options.remove&&(t=this._modes[L.EditToolbar.Delete.TYPE].button,i?L.DomUtil.removeClass(t,"leaflet-disabled"):L.DomUtil.addClass(t,"leaflet-disabled"),t.setAttribute("title",i?L.drawLocal.edit.toolbar.buttons.remove:L.drawLocal.edit.toolbar.buttons.removeDisabled))}}),L.EditToolbar.Edit=L.Handler.extend({statics:{TYPE:"edit"},includes:L.Mixin.Events,initialize:function(t,e){if(L.Handler.prototype.initialize.call(this,t),this._selectedPathOptions=e.selectedPathOptions,this._featureGroup=e.featureGroup,!(this._featureGroup instanceof L.FeatureGroup))throw new Error("options.featureGroup must be a L.FeatureGroup");this._uneditedLayerProps={},this.type=L.EditToolbar.Edit.TYPE},enable:function(){!this._enabled&&this._hasAvailableLayers()&&(this.fire("enabled",{handler:this.type}),this._map.fire("draw:editstart",{handler:this.type}),L.Handler.prototype.enable.call(this),this._featureGroup.on("layeradd",this._enableLayerEdit,this).on("layerremove",this._disableLayerEdit,this))},disable:function(){this._enabled&&(this._featureGroup.off("layeradd",this._enableLayerEdit,this).off("layerremove",this._disableLayerEdit,this),L.Handler.prototype.disable.call(this),this._map.fire("draw:editstop",{handler:this.type}),this.fire("disabled",{handler:this.type}))},addHooks:function(){var t=this._map;t&&(t.getContainer().focus(),this._featureGroup.eachLayer(this._enableLayerEdit,this),this._tooltip=new L.Tooltip(this._map),this._tooltip.updateContent({text:L.drawLocal.edit.handlers.edit.tooltip.text,subtext:L.drawLocal.edit.handlers.edit.tooltip.subtext}),this._map.on("mousemove",this._onMouseMove,this))},removeHooks:function(){this._map&&(this._featureGroup.eachLayer(this._disableLayerEdit,this),this._uneditedLayerProps={},this._tooltip.dispose(),this._tooltip=null,this._map.off("mousemove",this._onMouseMove,this))},revertLayers:function(){this._featureGroup.eachLayer(function(t){this._revertLayer(t)},this)},save:function(){var t=new L.LayerGroup;this._featureGroup.eachLayer(function(e){e.edited&&(t.addLayer(e),e.edited=!1)}),this._map.fire("draw:edited",{layers:t})},_backupLayer:function(t){var e=L.Util.stamp(t);this._uneditedLayerProps[e]||(t instanceof L.Polyline||t instanceof L.Polygon||t instanceof L.Rectangle?this._uneditedLayerProps[e]={latlngs:L.LatLngUtil.cloneLatLngs(t.getLatLngs())}:t instanceof L.Circle?this._uneditedLayerProps[e]={latlng:L.LatLngUtil.cloneLatLng(t.getLatLng()),radius:t.getRadius()}:t instanceof L.Marker&&(this._uneditedLayerProps[e]={latlng:L.LatLngUtil.cloneLatLng(t.getLatLng())}))},_revertLayer:function(t){var e=L.Util.stamp(t);t.edited=!1,this._uneditedLayerProps.hasOwnProperty(e)&&(t instanceof L.Polyline||t instanceof L.Polygon||t instanceof L.Rectangle?t.setLatLngs(this._uneditedLayerProps[e].latlngs):t instanceof L.Circle?(t.setLatLng(this._uneditedLayerProps[e].latlng),t.setRadius(this._uneditedLayerProps[e].radius)):t instanceof L.Marker&&t.setLatLng(this._uneditedLayerProps[e].latlng))},_toggleMarkerHighlight:function(t){if(t._icon){var e=t._icon;e.style.display="none",L.DomUtil.hasClass(e,"leaflet-edit-marker-selected")?(L.DomUtil.removeClass(e,"leaflet-edit-marker-selected"),this._offsetMarker(e,-4)):(L.DomUtil.addClass(e,"leaflet-edit-marker-selected"),this._offsetMarker(e,4)),e.style.display=""}},_offsetMarker:function(t,e){var i=parseInt(t.style.marginTop,10)-e,o=parseInt(t.style.marginLeft,10)-e;t.style.marginTop=i+"px",t.style.marginLeft=o+"px"},_enableLayerEdit:function(t){var e,i=t.layer||t.target||t,o=i instanceof L.Marker;(!o||i._icon)&&(this._backupLayer(i),this._selectedPathOptions&&(e=L.Util.extend({},this._selectedPathOptions),e.maintainColor&&(e.color=i.options.color,e.fillColor=i.options.fillColor),o?this._toggleMarkerHighlight(i):(i.options.previousOptions=L.Util.extend({dashArray:null},i.options),i instanceof L.Circle||i instanceof L.Polygon||i instanceof L.Rectangle||(e.fill=!1),i.setStyle(e))),o?(i.dragging.enable(),i.on("dragend",this._onMarkerDragEnd)):i.editing.enable())},_disableLayerEdit:function(t){var e=t.layer||t.target||t;e.edited=!1,this._selectedPathOptions&&(e instanceof L.Marker?this._toggleMarkerHighlight(e):(e.setStyle(e.options.previousOptions),delete e.options.previousOptions)),e instanceof L.Marker?(e.dragging.disable(),e.off("dragend",this._onMarkerDragEnd,this)):e.editing.disable()},_onMarkerDragEnd:function(t){var e=t.target;e.edited=!0},_onMouseMove:function(t){this._tooltip.updatePosition(t.latlng)},_hasAvailableLayers:function(){return 0!==this._featureGroup.getLayers().length}}),L.EditToolbar.Delete=L.Handler.extend({statics:{TYPE:"remove"},includes:L.Mixin.Events,initialize:function(t,e){if(L.Handler.prototype.initialize.call(this,t),L.Util.setOptions(this,e),this._deletableLayers=this.options.featureGroup,!(this._deletableLayers instanceof L.FeatureGroup))throw new Error("options.featureGroup must be a L.FeatureGroup");this.type=L.EditToolbar.Delete.TYPE},enable:function(){!this._enabled&&this._hasAvailableLayers()&&(this.fire("enabled",{handler:this.type}),this._map.fire("draw:deletestart",{handler:this.type}),L.Handler.prototype.enable.call(this),this._deletableLayers.on("layeradd",this._enableLayerDelete,this).on("layerremove",this._disableLayerDelete,this))},disable:function(){this._enabled&&(this._deletableLayers.off("layeradd",this._enableLayerDelete,this).off("layerremove",this._disableLayerDelete,this),L.Handler.prototype.disable.call(this),this._map.fire("draw:deletestop",{handler:this.type}),this.fire("disabled",{handler:this.type}))},addHooks:function(){var t=this._map;t&&(t.getContainer().focus(),this._deletableLayers.eachLayer(this._enableLayerDelete,this),this._deletedLayers=new L.layerGroup,this._tooltip=new L.Tooltip(this._map),this._tooltip.updateContent({text:L.drawLocal.edit.handlers.remove.tooltip.text}),this._map.on("mousemove",this._onMouseMove,this))},removeHooks:function(){this._map&&(this._deletableLayers.eachLayer(this._disableLayerDelete,this),this._deletedLayers=null,this._tooltip.dispose(),this._tooltip=null,this._map.off("mousemove",this._onMouseMove,this))},revertLayers:function(){this._deletedLayers.eachLayer(function(t){this._deletableLayers.addLayer(t)},this)},save:function(){this._map.fire("draw:deleted",{layers:this._deletedLayers})},_enableLayerDelete:function(t){var e=t.layer||t.target||t;e.on("click",this._removeLayer,this)},_disableLayerDelete:function(t){var e=t.layer||t.target||t;e.off("click",this._removeLayer,this),this._deletedLayers.removeLayer(e)},_removeLayer:function(t){var e=t.layer||t.target||t;this._deletableLayers.removeLayer(e),this._deletedLayers.addLayer(e)},_onMouseMove:function(t){this._tooltip.updatePosition(t.latlng)},_hasAvailableLayers:function(){return 0!==this._deletableLayers.getLayers().length}})}(window,document),L.Polyline.Measure=L.Draw.Polyline.extend({addHooks:function(){L.Draw.Polyline.prototype.addHooks.call(this),this._map&&(this._markerGroup=new L.LayerGroup,this._map.addLayer(this._markerGroup),this._markers=[],this._map.on("click",this._onClick,this),this._startShape())},removeHooks:function(){L.Draw.Polyline.prototype.removeHooks.call(this),this._clearHideErrorTimeout(),this._map.off("mousemove",this._onMouseMove),this._clearGuides(),this._container.style.cursor="",this._removeShape(),this._map.off("click",this._onClick,this)},_startShape:function(){this._drawing=!0,this._poly=new L.Polyline([],this.options.shapeOptions),this._container.style.cursor="crosshair",this._updateTooltip(),this._map.on("mousemove",this._onMouseMove,this)},_finishShape:function(){this._drawing=!1,this._cleanUpShape(),this._clearGuides(),this._updateTooltip(),this._map.off("mousemove",this._onMouseMove,this),this._container.style.cursor=""},_removeShape:function(){this._poly&&(this._map.removeLayer(this._poly),delete this._poly,this._markers.splice(0),this._markerGroup.clearLayers())},_onClick:function(t){return this._drawing?void 0:(this._removeShape(),void this._startShape())},_getTooltipText:function(){var t=L.Draw.Polyline.prototype._getTooltipText.call(this);return this._drawing||(t.text=""),t}}),L.Control.MeasureControl=L.Control.extend({statics:{TITLE:"Measure distances"},options:{position:"topleft",handler:{}},toggle:function(){this.handler.enabled()?this.handler.disable.call(this.handler):this.handler.enable.call(this.handler)},onAdd:function(t){var e="leaflet-control-draw";this._container=L.DomUtil.create("div","leaflet-bar"),this.handler=new L.Polyline.Measure(t,this.options.handler),this.handler.on("enabled",function(){L.DomUtil.addClass(this._container,"enabled")},this),this.handler.on("disabled",function(){L.DomUtil.removeClass(this._container,"enabled")},this);var i=L.DomUtil.create("a",e+"-measure",this._container);return i.href="#",i.title=L.Control.MeasureControl.TITLE,L.DomEvent.addListener(i,"click",L.DomEvent.stopPropagation).addListener(i,"click",L.DomEvent.preventDefault).addListener(i,"click",this.toggle,this),this._container}}),L.Map.mergeOptions({measureControl:!1}),L.Map.addInitHook(function(){this.options.measureControl&&(this.measureControl=L.Control.measureControl().addTo(this))}),L.Control.measureControl=function(t){return new L.Control.MeasureControl(t)},function(){var t;L.TimelineVersion="0.3.2",t=function(){function t(){this._root=null,this._list=null}return t.prototype.insert=function(t,e,i,o,s,n){var r;return void 0===o&&(o=this._root),o?(r=t<o.low||t===o.low&&e<o.high?this.insert(t,e,i,o.left,o,"left"):this.insert(t,e,i,o.right,o,"right"),o.max=Math.max(o.max,r.max),r):(r={low:t,high:e,max:e,data:i,left:null,right:null,parent:s},s?s[n]=r:this._root=r,r)},t.prototype.lookup=function(t,e){return void 0===e&&(e=this._root,this._list=[]),null===e||e.max<t?void 0:(null!==e.left&&this.lookup(t,e.left),e.low<=t&&(e.high>=t&&this._list.push(e.data),this.lookup(t,e.right)),this._list)},t}(),L.Timeline=L.GeoJSON.extend({includes:L.Mixin.Events,times:[],displayedLayers:[],ranges:null,options:{position:"bottomleft",formatDate:function(t){return""},enablePlayback:!0,steps:1e3,duration:1e4,showTicks:!0,waitToUpdateMap:!1},initialize:function(e,i){return L.GeoJSON.prototype.initialize.call(this,void 0,i),L.extend(this.options,i),this.ranges=new t,this.process(e)},process:function(t){var e,i;return e=1/0,i=-(1/0),t.features.forEach(function(t){return function(o){var s,n;return n=new Date(o.properties.start).getTime(),s=new Date(o.properties.end).getTime(),t.ranges.insert(n,s,o),t.times.push(n),t.times.push(s),e>n&&(e=n),s>i?i=s:void 0}}(this)),this.times=this.times.sort(),this.options.start||(this.options.start=e),this.options.end?void 0:this.options.end=i},addData:function(t){var e,i,o,s,n,r;if(i=L.Util.isArray(t)?t:t.features){for(n=0,r=i.length;r>n;n++)e=i[n],(e.geometries||e.geometry||e.features||e.coordinates)&&this.addData(e);return this}return s=this.options,!s.filter||s.filter(t)?(o=L.GeoJSON.geometryToLayer(t,s.pointToLayer),this.displayedLayers.push({layer:o,geoJSON:t}),o.feature=L.GeoJSON.asFeature(t),o.defaultOptions=o.options,this.resetStyle(o),s.onEachFeature&&s.onEachFeature(t,o),this.addLayer(o)):void 0},removeLayer:function(t,e){return null==e&&(e=!0),L.GeoJSON.prototype.removeLayer.call(this,t),e?this.displayedLayers=this.displayedLayers.filter(function(e){return e.layer!==t}):void 0},setTime:function(t){var e,i,o,s;this.time=new Date(t).getTime(),i=this.ranges.lookup(t);var n,r,a;for(n=0;n<this.displayedLayers.length;n++){for(a=!1,r=0;r<i.length;r++)if(this.displayedLayers[n].geoJSON===i[r]){a=!0,i.splice(r,1);break}if(!a){var l=this.displayedLayers.splice(n--,1);this.removeLayer(l[0].layer,!1)}}for(o=0,s=i.length;s>o;o++)e=i[o],this.addData(e);return this.fire("change")},onAdd:function(t){return L.GeoJSON.prototype.onAdd.call(this,t),this.timeSliderControl=L.Timeline.timeSliderControl(this),this.timeSliderControl.addTo(t)},getDisplayed:function(){return this.ranges.lookup(this.time)}}),L.Timeline.TimeSliderControl=L.Control.extend({initialize:function(t){return this.timeline=t,this.options.position=this.timeline.options.position,this.start=this.timeline.options.start,this.end=this.timeline.options.end,this.showTicks=this.timeline.options.showTicks,this.stepDuration=this.timeline.options.duration/this.timeline.options.steps,this.stepSize=(this.end-this.start)/this.timeline.options.steps},_buildDataList:function(t,e){var i,o;return this._datalist=L.DomUtil.create("datalist","",t),i=L.DomUtil.create("select","",this._datalist),o=[],e.forEach(function(t){var e;if(!o[t])return e=L.DomUtil.create("option","",i),e.value=t,o[t]=!0}),this._datalist.id="timeline-datalist-"+Math.floor(1e6*Math.random()),this._timeSlider.setAttribute("list",this._datalist.id)},_makePlayPause:function(t){return this._playButton=L.DomUtil.create("button","play",t),this._playButton.addEventListener("click",function(t){return function(){return t._play()}}(this)),L.DomEvent.disableClickPropagation(this._playButton),this._pauseButton=L.DomUtil.create("button","pause",t),this._pauseButton.addEventListener("click",function(t){return function(){return t._pause()}}(this)),L.DomEvent.disableClickPropagation(this._pauseButton)},_makePrevNext:function(t){return this._prevButton=L.DomUtil.create("button","prev"),this._nextButton=L.DomUtil.create("button","next"),this._playButton.parentNode.insertBefore(this._prevButton,this._playButton),this._playButton.parentNode.insertBefore(this._nextButton,this._pauseButton.nextSibling),L.DomEvent.disableClickPropagation(this._prevButton),L.DomEvent.disableClickPropagation(this._nextButton),this._prevButton.addEventListener("click",this._prev.bind(this)),this._nextButton.addEventListener("click",this._next.bind(this))},_makeSlider:function(t){return this._timeSlider=L.DomUtil.create("input","time-slider",t),this._timeSlider.type="range",this._timeSlider.min=this.start,this._timeSlider.max=this.end,this._timeSlider.value=this.start,this._timeSlider.addEventListener("mousedown",function(t){return function(){return t.map.dragging.disable()}}(this)),document.addEventListener("mouseup",function(t){return function(){return t.map.dragging.enable()}}(this)),this._timeSlider.addEventListener("input",this._sliderChanged.bind(this)),this._timeSlider.addEventListener("change",this._sliderChanged.bind(this))},_makeOutput:function(t){return this._output=L.DomUtil.create("output","time-text",t),this._output.innerHTML=this.timeline.options.formatDate(new Date(this.start))},_nearestEventTime:function(t,e){var i,o,s,n,r,a,l,h;for(null==e&&(e=0),n=!1,i=this.timeline.times[0],h=this.timeline.times.slice(1),a=0,l=h.length;l>a;a++){if(r=h[a],n)return r;if(r>=t){if(-1===e)return i;if(1!==e)return s=Math.abs(t-i),o=Math.abs(r-t),o>s?s:o;if(r!==t)return r;n=!0}i=r}return i},_prev:function(){var t;return this._pause(),t=this._nearestEventTime(this.timeline.time,-1),this._timeSlider.value=t,this.timeline.setTime(t)},_pause:function(){return clearTimeout(this._timer),this.container.classList.remove("playing")},_play:function(){return clearTimeout(this._timer),+this._timeSlider.value===this.end&&(this._timeSlider.value=this.start),this._timeSlider.stepUp(this.stepSize),this._sliderChanged({type:"change",target:{value:this._timeSlider.value}}),+this._timeSlider.value!==this.end?(this.container.classList.add("playing"),this._timer=setTimeout(this._play.bind(this,this.stepDuration))):this.container.classList.remove("playing")},_next:function(){var t;return this._pause(),t=this._nearestEventTime(this.timeline.time,1),this._timeSlider.value=t,this.timeline.setTime(t)},_sliderChanged:function(t){var e;return e=+t.target.value,this.timeline.options.waitToUpdateMap&&"change"!==t.type||this.timeline.setTime(e),this._output.innerHTML=this.timeline.options.formatDate(new Date(e))},onAdd:function(t){var e,i;return this.map=t,i=L.DomUtil.create("div","leaflet-control-layers leaflet-control-layers-expanded leaflet-timeline-controls"),this.timeline.options.enablePlayback&&(e=L.DomUtil.create("div","button-container",i),this._makePlayPause(e),this._makePrevNext(e)),this._makeSlider(i),this.showTicks&&this._buildDataList(i,this.timeline.times),this._makeOutput(i),this.timeline.setTime(this.start),this.container=i}}),L.timeline=function(t,e){return new L.Timeline(t,e)},L.Timeline.timeSliderControl=function(t,e,i,o){return new L.Timeline.TimeSliderControl(t,e,i,o)}}.call(this);var FileLoader=L.Class.extend({includes:L.Mixin.Events,options:{layerOptions:{},fileSizeLimit:1024},initialize:function(t,e){this._map=t,L.Util.setOptions(this,e),this._parsers={geojson:this._loadGeoJSON,gpx:this._convertToGeoJSON,kml:this._convertToGeoJSON}},load:function(t){var e=(t.size/1024).toFixed(4);if(e>this.options.fileSizeLimit)return void this.fire("data:error",{error:new Error("File size exceeds limit ("+e+" > "+this.options.fileSizeLimit+"kb)")});var i=t.name.split(".").pop(),o=this._parsers[i];if(!o)return void this.fire("data:error",{error:new Error("Unsupported file type "+t.type+"("+i+")")});var s=new FileReader;return s.onload=L.Util.bind(function(e){try{this.fire("data:loading",{filename:t.name,format:i});var s=o.call(this,e.target.result,i);this.fire("data:loaded",{layer:s,filename:t.name,format:i})}catch(n){this.fire("data:error",{error:n})}},this),s.readAsText(t),s},_loadGeoJSON:function(t){"string"==typeof t&&(t=JSON.parse(t));var e=L.geoJson(t,this.options.layerOptions);if(0===e.getLayers().length)throw new Error("GeoJSON has no valid layers.");return this.options.addToMap&&e.addTo(this._map),e},_convertToGeoJSON:function(t,e){"string"==typeof t&&(t=(new window.DOMParser).parseFromString(t,"text/xml"));var i=toGeoJSON[e](t);return this._loadGeoJSON(i)}});L.Control.FileLayerLoad=L.Control.extend({statics:{TITLE:"Load local file (GPX, KML, GeoJSON)",LABEL:"&#8965;"},options:{position:"topleft",fitBounds:!0,layerOptions:{},addToMap:!0,fileSizeLimit:1024},initialize:function(t){L.Util.setOptions(this,t),this.loader=null},onAdd:function(t){return this.loader=new FileLoader(t,this.options),this.loader.on("data:loaded",function(e){this.options.fitBounds&&window.setTimeout(function(){t.fitBounds(e.layer.getBounds())},500)},this),this._initDragAndDrop(t),this._initContainer()},_initDragAndDrop:function(t){var e=this.loader,i=t._container,o={dragenter:function(){t.scrollWheelZoom.disable()},dragleave:function(){t.scrollWheelZoom.enable()},dragover:function(t){t.stopPropagation(),t.preventDefault()},drop:function(i){i.stopPropagation(),i.preventDefault();var o=Array.prototype.slice.apply(i.dataTransfer.files);o.length;setTimeout(function(){e.load(o.shift()),o.length>0&&setTimeout(arguments.callee,25)},25),t.scrollWheelZoom.enable()}};for(var s in o)i.addEventListener(s,o[s],!1)},_initContainer:function(){var t="leaflet-control-filelayer leaflet-control-zoom",e="leaflet-bar",i=e+"-part",o=L.DomUtil.create("div",t+" "+e),s=L.DomUtil.create("a",t+"-in "+i,o);s.innerHTML=L.Control.FileLayerLoad.LABEL,s.href="#",s.title=L.Control.FileLayerLoad.TITLE;var n=L.DomUtil.create("input","hidden",o);
n.type="file",this.options.formats?n.accept=this.options.formats.join(","):n.accept=".gpx,.kml,.geojson",n.style.display="none";var r=this.loader;return n.addEventListener("change",function(t){r.load(this.files[0]),this.value=""},!1),L.DomEvent.disableClickPropagation(s),L.DomEvent.on(s,"click",function(t){n.click(),t.preventDefault()}),o}}),L.Control.fileLayerLoad=function(t){return new L.Control.FileLayerLoad(t)},L.SpinMapMixin={spin:function(t,e){t?(this._spinner||(this._spinner=new Spinner(e).spin(this._container),this._spinning=0),this._spinning++):(this._spinning--,this._spinning<=0&&this._spinner&&(this._spinner.stop(),this._spinner=null))}},L.Map.include(L.SpinMapMixin),L.Map.addInitHook(function(){this.on("layeradd",function(t){t.layer.loading&&this.spin(!0),"function"==typeof t.layer.on&&(t.layer.on("data:loading",function(){this.spin(!0)},this),t.layer.on("data:loaded",function(){this.spin(!1)},this))},this),this.on("layerremove",function(t){t.layer.loading&&this.spin(!1),"function"==typeof t.layer.on&&(t.layer.off("data:loaded"),t.layer.off("data:loading"))},this)}),!function(t,e){"object"==typeof exports?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Spinner=e()}(this,function(){"use strict";function t(t,e){var i,o=document.createElement(t||"div");for(i in e)o[i]=e[i];return o}function e(t){for(var e=1,i=arguments.length;i>e;e++)t.appendChild(arguments[e]);return t}function i(t,e,i,o){var s=["opacity",e,~~(100*t),i,o].join("-"),n=.01+i/o*100,r=Math.max(1-(1-t)/e*(100-n),t),a=h.substring(0,h.indexOf("Animation")).toLowerCase(),l=a&&"-"+a+"-"||"";return d[s]||(p.insertRule("@"+l+"keyframes "+s+"{0%{opacity:"+r+"}"+n+"%{opacity:"+t+"}"+(n+.01)+"%{opacity:1}"+(n+e)%100+"%{opacity:"+t+"}100%{opacity:"+r+"}}",p.cssRules.length),d[s]=1),s}function o(t,e){var i,o,s=t.style;if(e=e.charAt(0).toUpperCase()+e.slice(1),void 0!==s[e])return e;for(o=0;o<c.length;o++)if(i=c[o]+e,void 0!==s[i])return i}function s(t,e){for(var i in e)t.style[o(t,i)||i]=e[i];return t}function n(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var o in i)void 0===t[o]&&(t[o]=i[o])}return t}function r(t,e){return"string"==typeof t?t:t[e%t.length]}function a(t){this.opts=n(t||{},a.defaults,u)}function l(){function i(e,i){return t("<"+e+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',i)}p.addRule(".spin-vml","behavior:url(#default#VML)"),a.prototype.lines=function(t,o){function n(){return s(i("group",{coordsize:p+" "+p,coordorigin:-h+" "+-h}),{width:p,height:p})}function a(t,a,l){e(d,e(s(n(),{rotation:360/o.lines*t+"deg",left:~~a}),e(s(i("roundrect",{arcsize:o.corners}),{width:h,height:o.scale*o.width,left:o.scale*o.radius,top:-o.scale*o.width>>1,filter:l}),i("fill",{color:r(o.color,t),opacity:o.opacity}),i("stroke",{opacity:0}))))}var l,h=o.scale*(o.length+o.width),p=2*o.scale*h,c=-(o.width+o.length)*o.scale*2+"px",d=s(n(),{position:"absolute",top:c,left:c});if(o.shadow)for(l=1;l<=o.lines;l++)a(l,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(l=1;l<=o.lines;l++)a(l);return e(t,d)},a.prototype.opacity=function(t,e,i,o){var s=t.firstChild;o=o.shadow&&o.lines||0,s&&e+o<s.childNodes.length&&(s=s.childNodes[e+o],s=s&&s.firstChild,s=s&&s.firstChild,s&&(s.opacity=i))}}var h,p,c=["webkit","Moz","ms","O"],d={},u={lines:12,length:7,width:5,radius:10,scale:1,corners:1,color:"#000",opacity:.25,rotate:0,direction:1,speed:1,trail:100,fps:20,zIndex:2e9,className:"spinner",top:"50%",left:"50%",shadow:!1,hwaccel:!1,position:"absolute"};if(a.defaults={},n(a.prototype,{spin:function(e){this.stop();var i=this,o=i.opts,n=i.el=t(null,{className:o.className});if(s(n,{position:o.position,width:0,zIndex:o.zIndex,left:o.left,top:o.top}),e&&e.insertBefore(n,e.firstChild||null),n.setAttribute("role","progressbar"),i.lines(n,i.opts),!h){var r,a=0,l=(o.lines-1)*(1-o.direction)/2,p=o.fps,c=p/o.speed,d=(1-o.opacity)/(c*o.trail/100),u=c/o.lines;!function _(){a++;for(var t=0;t<o.lines;t++)r=Math.max(1-(a+(o.lines-t)*u)%c*d,o.opacity),i.opacity(n,t*o.direction+l,r,o);i.timeout=i.el&&setTimeout(_,~~(1e3/p))}()}return i},stop:function(){var t=this.el;return t&&(clearTimeout(this.timeout),t.parentNode&&t.parentNode.removeChild(t),this.el=void 0),this},lines:function(o,n){function a(e,i){return s(t(),{position:"absolute",width:n.scale*(n.length+n.width)+"px",height:n.scale*n.width+"px",background:e,boxShadow:i,transformOrigin:"left",transform:"rotate("+~~(360/n.lines*p+n.rotate)+"deg) translate("+n.scale*n.radius+"px,0)",borderRadius:(n.corners*n.scale*n.width>>1)+"px"})}for(var l,p=0,c=(n.lines-1)*(1-n.direction)/2;p<n.lines;p++)l=s(t(),{position:"absolute",top:1+~(n.scale*n.width/2)+"px",transform:n.hwaccel?"translate3d(0,0,0)":"",opacity:n.opacity,animation:h&&i(n.opacity,n.trail,c+p*n.direction,n.lines)+" "+1/n.speed+"s linear infinite"}),n.shadow&&e(l,s(a("#000","0 0 4px #000"),{top:"2px"})),e(o,e(l,a(r(n.color,p),"0 0 1px rgba(0,0,0,.1)")));return o},opacity:function(t,e,i){e<t.childNodes.length&&(t.childNodes[e].style.opacity=i)}}),"undefined"!=typeof document){p=function(){var i=t("style",{type:"text/css"});return e(document.getElementsByTagName("head")[0],i),i.sheet||i.styleSheet}();var _=s(t("group"),{behavior:"url(#default#VML)"});!o(_,"transform")&&_.adj?l():h=o(_,"animation")}return a});
